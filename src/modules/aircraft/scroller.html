<!DOCTYPE html>
<html>
    <head>
        <script src="https://unpkg.com/konva@9.0.2/konva.min.js"></script>
        <meta charset="utf-8" />
        <title>Konva Canvas Scrolling Demo</title>
        <style>
            body {
                margin: 0;
                padding: 0;
                overflow: hidden;
                background-color: #f0f0f0;
                height: 100%;
                overflow: auto;
            }

            #large-container {
                width: 3000px;
                height: 3000px;
                overflow: hidden;
            }

            #scroll-container {
                width: calc(100% - 22px);
                height: calc(100vh - 22px);
                overflow: auto;
                margin: 10px;
                border: 1px solid grey;
            }
        </style>
    </head>

    <body>
        <div id="scroll-container">
            <div id="large-container">
                <div id="container"></div>
            </div>
        </div>
        <script>
            var now = Date.now();
            var timeRange = 3 * 24 * 3600 * 1000;

            var chartSettings = {
                timeScale: {
                    from: now,
                    to: now + timeRange,
                    range: timeRange
                },
                stage: {
                    width: 0,
                    height: 0
                }
            };

            //
            function getRandomOffset(min, max) {
                return min * 1000 + Math.floor(Math.random() * (max - min) * 1000);
            }

            function generateLeg(tailIndex, startTime) {
                var takeoff = startTime;
                var landing = takeoff + getRandomOffset(1200, 12000);
                return {
                    tail: tailIndex,
                    tsFrom: takeoff,
                    tsTo: landing
                };
            }

            function generateLegs(tailsNum, legsNum) {
                var legs = [];
                var startTime = 0;
                var leg = null;
                for (var i = 0; i < tailsNum; i++) {
                    startTime = Date.now() + getRandomOffset(0, 7200);

                    for (var j = 0; j < legsNum; j++) {
                        //console.log(j);
                        leg = generateLeg(i, startTime);
                        //console.log("leg=", leg);
                        startTime = leg.tsTo + getRandomOffset(300, 12000);
                        legs.push(leg);
                    }
                }
                return legs;
            }
            var legs = generateLegs(100, 200);
            //console.log('legs=', legs);

            var WIDTH = 3000;
            var HEIGHT = 3000;
            var NUMBER = 200;

            // padding will increase the size of stage
            // so scrolling will look smoother
            var PADDING = 500;

            var stage = new Konva.Stage({
                container: "container",
                width: window.innerWidth + PADDING * 2,
                height: window.innerHeight + PADDING * 2
            });
            chartSettings.stage.width = window.innerWidth;
            chartSettings.stage.height = window.innerHeight;

            var layer = new Konva.Layer();
            stage.add(layer);

            function tsToPositionX(ts) {
                console.log("ts=", ts);
                console.log("stage.width=", stage.width);
                return chartSettings.stage.width * (ts / chartSettings.timeScale.range);
            }

            var nodes = legs.map(function (item) {
                return new Konva.Rect({
                    x: tsToPositionX(item.tsFrom - chartSettings.timeScale.from),
                    y: 10 + item.tail * 100,
                    width: tsToPositionX(item.tsTo - item.tsFrom),
                    height: 80,
                    cornerRadius: 5,
                    fill: "blue",
                    stroke: "black"
                });
            });

            console.log(nodes);
            /*
      function generateNode() {
        return new Konva.Circle({
          x: WIDTH * Math.random(),
          y: HEIGHT * Math.random(),
          radius: 50,
          fill: 'red',
          stroke: 'black',
        });
      }

      for (var i = 0; i < NUMBER; i++) {
        layer.add(generateNode());
      }*/
            for (var i = 0; i < nodes.length; i++) {
                console.log("node=", nodes[i]);
                layer.add(nodes[i]);
            }

            var scrollContainer = document.getElementById("scroll-container");
            function repositionStage() {
                var dx = scrollContainer.scrollLeft - PADDING;
                var dy = scrollContainer.scrollTop - PADDING;
                stage.container().style.transform = "translate(" + dx + "px, " + dy + "px)";
                stage.x(-dx);
                stage.y(-dy);
            }
            scrollContainer.addEventListener("scroll", repositionStage);
            repositionStage();
        </script>
    </body>
</html>
