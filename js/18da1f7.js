(self.webpackChunkcode_example=self.webpackChunkcode_example||[]).push([[179],{2822:(e,t,r)=>{"use strict";r.d(t,{Z:()=>u});var a=r(1860),s=r.n(a),n=r(7840);const i=window.matchMedia("(any-pointer: coarse)").matches,o=document.createElement("canvas").getContext("2d"),c={storage:s(),formatter:{normalizePropName:e=>(e.endsWith("ID")&&(e=`${e.slice(0,-2)}Id`),_.camelCase(e)),normalizePropNames:e=>_.isObject(e)?_.isArray(e)?e.map((e=>c.formatter.normalizePropNames(e))):Object.keys(e).reduce(((t,r)=>(t[c.formatter.normalizePropName(r)]=c.formatter.normalizePropNames(e[r]),t)),{}):e,toUniqueSpaces:e=>e.replace(/(\s)+/g,"$1")},sleep:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((t=>setTimeout(t,e)))},retry:async(e,t)=>{let{onEachRetryError:r,retries:a,retryIntervalMs:s}=t;try{return await e()}catch(t){if(r(a),a<=0)throw t;return await c.sleep(s),c.retry(e,{onEachRetryError:r,retries:a-1,retryIntervalMs:s})}},isMobileDevice:()=>i,canvas:{getTextWidth(e){let{text:t,font:r,fontSize:a,fontFamily:s=n.Z["font-family"]}=e;return o.font=r||`${a}px ${s}`,Math.ceil(o.measureText(t).width)},getTextHeight(e){let{fontSize:t,fontFamily:r=n.Z["font-family"]}=e;const a=`bold ${t}px ${r}`;return o.font=a,c.canvas.getTextWidth({text:"M",font:a})}}},u=c},8532:(e,t,r)=>{"use strict";var a=r(6486),s=r.n(a),n=r(830),i=r(9963),o=r(6168),c=r.n(o),u=r(7484),d=r.n(u),l=(r(600),r(6036)),h=r.n(l),g=r(178),m=r.n(g),p=r(1646),f=r.n(p),y=r(8840),v=r.n(y),w=r(5130),k=r.n(w),P=r(1913),b=r.n(P),U=r(8393),x=r.n(U),Z=r(4625),O=r.n(Z),S=r(2929),C=r.n(S),A=r(2861),$=r(8662),I=r(7347),M=r.n(I),V=r(6252);const E={},R=(0,r(3744).Z)(E,[["render",function(e,t){const r=(0,V.up)("router-view");return(0,V.wg)(),(0,V.j4)(r)}]]);var T=r(2201),D=r(129),N=r.n(D),q=r(2262),Q=r(8085);const z=/Edge?\/(10[7-9]|1[1-9]\d|[2-9]\d{2}|\d{4,})(\.\d+|)(\.\d+|)|Firefox\/(10[7-9]|1[1-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Chrom(ium|e)\/(10[89]|1[1-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Maci.+ Version\/(1[6-9]|[2-9]\d|\d{3,})\.\d+([,.]\d+|)( Mobile\/\w+|) Safari\/|Chrome.+OPR\/(9[1-9]|\d{3,})\.\d+\.\d+|(CPU[ +]OS|iPhone[ +]OS|CPU[ +]iPhone|CPU IPhone OS|CPU iPad OS)[ +]+(1[5-9]|[2-9]\d|\d{3,})[._]\d+([._]\d+|)|Android:?[ /-](1{2}[1-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})(\.\d+|)(\.\d+|)|Mobile Safari.+OPR\/(7[3-9]|[89]\d|\d{3,})\.\d+\.\d+|Android.+Firefox\/(1{2}\d|1[2-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+Chrom(ium|e)\/(1{2}[1-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+(UC? ?Browser|UCWEB|U3)[ /]?(1[3-9]|[2-9]\d|\d{3,})\.\d+\.\d+|SamsungBrowser\/(1[6-9]|[2-9]\d|\d{3,})\.\d+|Android.+MQ{2}Browser\/(1[3-9]|[2-9]\d|\d{3,})(\.\d+|)(\.\d+|)|K[Aa][Ii]OS\/([2-9]|\d{2,})\.\d+(\.\d+|)/;var F=r(6294),j=r(2822);let B;const W="app.lastVisitedRoute";function K(e){return r(2275)(`./${e}.vue`)}const L="browser-is-not-supported",H="aircraft.flights.konva",G=()=>!z.test(navigator.userAgent),J=(0,T.p7)({history:(0,T.r5)("/"),parseQuery:e=>N().parse(e),stringifyQuery:e=>N().stringify(e)||"",routes:[{path:"/",name:"index",redirect:{name:"aircraft.flights.konva.nativeScrollbars"}},{path:"/aircraft/flights/konva",name:H,component:()=>K("aircraft/flights/konva/index"),meta:{title:"Перелеты konva"}},{path:"/aircraft/flights/highcharts-gantt",name:"aircraft.flights.gantt",component:()=>K("aircraft/flights/highcharts-gantt/index"),meta:{title:"Перелеты highcharts-gantt"}},{path:"/aircraft/flights/konva/native-scrollbars",name:"aircraft.flights.konva.nativeScrollbars",component:()=>K("aircraft/flights/konva/native-scrollbars"),meta:{title:"Перелеты konva native-scrollbars"}},{path:"/aircraft",redirect:{path:"/aircraft/flights"}},{path:"/aircraft/flights",redirect:{name:H}},{path:"/vehicle/routes",name:"vehicle.routes",component:()=>K("vehicle/routes/index"),meta:{title:"Маршруты транспортных средств"}},{path:"/vehicle/routes/:id(\\d+)",name:"vehicle.routes.id",component:()=>K("vehicle/routes/[id]"),props:e=>({id:+e.params.id}),meta:{title:"Маршрут {{ id }} транспортного средства"}},{path:"/vehicle",redirect:{name:"vehicle.routes"}},{path:"/login",name:"login",component:()=>K("login"),async beforeEnter(e,t,r){await new F.Z(J).isUserAuthenticated()?r({name:"index",replace:!0}):r()},meta:{public:!0,title:"Вход"}},{path:"/logout",name:"logout",async beforeEnter(e,t,r){try{await new F.Z(J).logout()}finally{r({name:"login",query:{redirect:{path:B.path,query:B.query}},replace:!0})}},meta:{public:!0}},{path:"/browser-is-not-supported",name:L,component:()=>K(L),beforeEnter(e,t,r){G()?r():r({name:"index",replace:!0})},meta:{public:!0,title:"Версия браузера не поддерживается"}},{path:"/:pathMatch(.*)*",name:"not-found",component:()=>K("not-found"),meta:{public:!0,title:"Страница не найдена"}}]});function X(e){console.debug(`${e.name}: ${Math.ceil(e.value)}ms == '${e.rating}'`)}J.beforeEach((async(e,t,r)=>{if(document.title=_.template(e?.meta?.title||"\ufeff")(e.params),B=j.Z.storage.get(W),j.Z.storage.remove(W),G()&&e.name!==L)return void r({name:L,replace:!0});const a=new F.Z(J);if(e.matched.some((e=>!e.meta.public)))return await a.isUserAuthenticated()?void r():void r({name:"login",query:{redirect:{path:e.path,query:e.query}}});r()})),window.addEventListener("beforeunload",(()=>{const e=(0,q.SU)(J.currentRoute);j.Z.storage.set(W,{path:e.path,query:e.query})})),(0,Q.a4)(X),(0,Q.NO)(X);const Y=J;const ee=r(7840).Z["font-family"].split(",")[0].slice(1,-1);new(M())(ee).load();const te=(0,i.createApp)(R);te.config.globalProperties={productionAbsoluteUrl:"//github.com/cakkypamucm",Math,logValueToConsole:e=>(console.debug(e),e)},d().locale("ru"),d().extend(h()),d().extend(m()),d().extend(f()),window.dayjs=d(),b()(v()),x()(v()),O()(v()),C()(v());const re=new Intl.NumberFormat("ru-RU").formatToParts(99999.99),{value:ae}=re.find((e=>"decimal"===e.type)),{value:se}=re.find((e=>"group"===e.type));v().setOptions({lang:{decimalPoint:ae,thousandsSep:se,weekdays:d().weekdays(),weekdaysShort:d().weekdaysMin(),months:d().months(),shortMonths:d().monthsShort()}}),te.use((0,n.WB)()).use(Y).use(c(),{prefix:"K"}).use(k()).mount("#app"),(0,$.ZP)(A.Z,{retries:2,retryDelay:()=>50}),window.$http=A.Z,s().templateSettings.interpolate=/{{([\S\s]+?)}}/g,s().templateSettings.evaluate=/{#([\S\s]+?)#}/g,window._=s()},6294:(e,t,r)=>{"use strict";r.d(t,{Z:()=>u});r(7658);var a=r(2262),s=r(830),n=(r(1703),r(2822));class i{constructor(){this.storageIds={userData:"app.user.data",firstTime:"app.user.first.time",packageVersion:"app.package.version"},this.userData={id:1,name:"name"}}isUserAuthenticated(){return new Promise((e=>{e(n.Z.storage.has(this.storageIds.userData))}))}login(){return new Promise(((e,t)=>{const r=n.Z.storage.get(this.storageIds.userData);if(r)e(r);else try{const t=i._fakeQueryRetry("login",this.userData);n.Z.storage.set(this.storageIds.userData,t),e(t)}catch(e){t(e)}}))}async logout(){try{return await i._fakeQueryRetry("logout")}finally{n.Z.storage.remove(this.storageIds.userData)}}static async _fakeQueryRetry(e,t){const r=await n.Z.retry((()=>i._fakeQuery(e,t)),{onEachRetryError:t=>{console.debug(`${e}: неудачная попытка, осталось еще ${t} раз(а)`)},retries:2,retryIntervalMs:50});return console.debug(`${e}: успешное получение данных`),r}static _fakeQuery(e,t){return new Promise(((r,a)=>{setTimeout((()=>{Math.random()>.1**(1/3)?r(t):a(new Error(`Не удалось выполнить запрос ${e}`))}),400*Math.random())}))}getPackageVersion(){return new Promise((e=>{e(n.Z.storage.get(this.storageIds.packageVersion))}))}setPackageVersion(e){return new Promise((t=>{n.Z.storage.set(this.storageIds.packageVersion,e),t()}))}isUserNew(){return new Promise((e=>{e(!n.Z.storage.has(this.storageIds.firstTime))}))}setUserOld(){return new Promise((e=>{n.Z.storage.set(this.storageIds.firstTime,!1),e()}))}}const o=new i,c=(0,s.Q_)("auth",{state:()=>({userData:null}),actions:{isUserAuthenticated:()=>o.isUserAuthenticated(),async login(){this.userData=await o.login()},logout:()=>o.logout(),getPackageVersion:()=>o.getPackageVersion(),setPackageVersion:e=>o.setPackageVersion(e),isUserNew:()=>o.isUserNew(),setUserOld:()=>o.setUserOld()}});class u{constructor(e){if(u.instance)return u.instance;u.instance=this,this.$router=e,this.store=c(),this.scheduleTimeoutId=null,this.ensurePackageVersion()}async isUserAuthenticated(){const e=await this.store.isUserAuthenticated();clearTimeout(this.scheduleTimeoutId);const t=this.getCurrentRoute();return t.meta?.public||this.scheduleCheckAuth(),e}scheduleCheckAuth(){this.scheduleTimeoutId=setTimeout((async()=>{if(await this.isUserAuthenticated())this.scheduleCheckAuth();else{"login"!==this.getCurrentRoute().name&&this.$router.push({name:"login"})}}),6e4)}async login(){const e=await this.store.login(),t=this.getCurrentRoute(),{redirect:{path:r,query:a}}=t.query;return r&&r!==t.path?this.$router.push({path:r,query:a,replace:!0}):this.$router.push({name:"index",query:a}),e}logout(){return this.store.logout()}async ensurePackageVersion(){"1.14.5"!==await this.getPackageVersion()&&(console.debug("выпущен новый релиз, необходим logout, затем login"),await this.setPackageVersion("1.14.5"),this.$router.push({name:"logout"}))}getPackageVersion(){return this.store.getPackageVersion()}setPackageVersion(e){return this.store.setPackageVersion(e)}getCurrentRoute(){return(0,a.SU)(this.$router.currentRoute)}async isUserNew(){const e=await this.store.isUserNew();return e&&await this.setUserOld(),e}setUserOld(){return this.store.setUserOld()}}},7840:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});const a={"font-family":'"Roboto Slab",serif',"help-text-color":"#6c757d"}},2275:(e,t,r)=>{var a={"./aircraft/flights/highcharts-gantt/index.vue":[4691,216,599],"./aircraft/flights/konva/index.vue":[4166,216,900,295],"./aircraft/flights/konva/native-scrollbars.vue":[8890,216,900,736],"./browser-is-not-supported.vue":[3833,174],"./login.vue":[5719,216,44],"./not-found.vue":[3428,19],"./vehicle/routes/[id].vue":[3340,216,971,74],"./vehicle/routes/index.vue":[2887,216,971,72]};function s(e){if(!r.o(a,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],s=t[0];return Promise.all(t.slice(1).map(r.e)).then((()=>r(s)))}s.keys=()=>Object.keys(a),s.id=2275,e.exports=s},4654:()=>{}},e=>{e.O(0,[216],(()=>{return t=8532,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=18da1f7.js.map