"use strict";(self.webpackChunkcode_example=self.webpackChunkcode_example||[]).push([[599],{9973:(t,e,r)=>{r.d(e,{Z:()=>g});var a=r(6767),i=r.n(a),s=r(8976),o=r(2822);const n="#cecece",h="#8eaaff",d="#c1c1c1",c="HH:mm",l="DD.MM",f=`DD MMM, ${c}`,u="Добавьте сюда воздушные суда",g={row:{height:60,padding:6},stageBackgroundColor:"white",fixedLayerBorderStroke:"black",betweenItemsLineStroke:n,timelinePrimaryColor:i()(n).darken(.4).hex(),mainLayer:{flightRectTimeoutMs:4e3,rect:{regularFill:h,activeFill:i()(h).darken(.25).hex(),minimumPaddingX:5,strokeWidth:2},noAircraftsMessage:{width:o.Z.canvas.getTextWidth({text:u,fontSize:16}),height:o.Z.canvas.getTextHeight({fontSize:16}),text:u,fontSize:16,fill:s.Z["help-text-color"]}},fixedAside:{width:110},fixedHeader:{height:40},stageScrollbarLayer:{bar:{minimumGreaterDimension:64,width:o.Z.isMobileDevice()?32:12,padding:0,regularFill:d,activeFill:i()(d).darken(.1).hex(),opacity:.7},aircraftNumber:{y:22,fontSize:12},datetime:{text:"Дата/время",y:5,fontSize:12}},timelineGrid:{opacity:{specialHour:1,regularHour:.3}},timelineLegend:{startOfDay:{underlineY:26,textStartY:8,dateFormat:l},startOfQuarterDay:{underlineY:32,textStartY:18,fontSize:12,dateFormat:c}},chartTitle:"Расписание перелетов",departure:"Вылет",arrival:"Посадка",aircraft:{generateId:()=>+Math.random().toFixed(5).slice(2),number:"Номер борта",prefixName:"RA-"},flight:{types:{service:{availability:{id:"availability",fill:"#7f84ea",text:"Availability"},maintenance:{id:"maintenance",fill:"#cd7e31",text:"Maintenance"}}}},arrow:{color:"black",pointerSize:2,strokeWidth:2,length:20,fontSize:10,correctionRelatedFontDateY:3},brackets:{size:10,strokeColor:"blue"},timeFormat:c,shortTimeFormat:"H",dateFormat:f,shortDateFormat:l}},6755:(t,e,r)=>{r.d(e,{Z:()=>o});var a=r(7578),i=r(9973);const s={store:(0,a.Z)(),setWidthCorrectionPx(t){this.widthCorrectionPx=t},setHeightCorrectionPx(t){this.heightCorrectionPx=t},totalHeight(){return this.store.aircrafts.length?this.heightCorrectionPx+this.store.aircrafts.length*i.Z.row.height:i.Z.mainLayer.noAircraftsMessage.height},totalWidth(){return this.store.maxArrivalMs?this.widthCorrectionPx+this.dateToPx(new Date(this.store.maxArrivalMs))+this.getTotalWidthCorrection():i.Z.mainLayer.noAircraftsMessage.width},dateToPx(t){const e=new Date(this.store.minDepartureMs);return dayjs(t).diff(e,"minute")},getCurrentXByIndex(t){return this.widthCorrectionPx+this.dateToPx(dayjs(this.store.minDepartureMs).add(1,"hour").startOf("hour").toDate())+(t-1)*this.getHourInPx()},getCurrentDateByIndex(t){return dayjs(this.store.minDepartureMs).add(t,"hour").startOf("hour")},getHourInPx(){return this.dateToPx(dayjs(this.store.minDepartureMs).add(1,"hour").toDate())},getTotalWidthCorrection(){let t=this.getHourInPx()/2;return this.isSpecialHour(dayjs(this.store.maxArrivalMs).hour())&&(t+=this.getHourInPx()/2),t},isSpecialHour:t=>t%6==0},o=new class{constructor(){this.store=(0,a.Z)(),this.timeline=s}async fetch(t,e){const r=await this.store.fetch(t,e);return window.backdoor=this.store,r}getFlightSummary(t){const e=this.store.getAircraftByFlightId(t),r=this.store.getFlight(t);if(null==e||null==r)return"Некорректный flightId";const a=t=>dayjs(t).format(i.Z.dateFormat);return`${i.Z.aircraft.number}: ${e.name}        \n        \n${i.Z.departure}: ${a(r.departureDate)}\n        \n${i.Z.arrival}: ${a(r.arrivalDate)}`}}},7578:(t,e,r)=>{r.d(e,{Z:()=>h});r(7658);var a=r(830),i=r(9973);const s={fetch(t,e){return new Promise((r=>r(this.generate(t,e))))},generate(t,e){t=Number.parseInt(t),(Number.isNaN(t)||t<0)&&(t=12),e=Number.parseInt(e),(Number.isNaN(e)||e<=0)&&(e=10);const r=[],a={},s=_.range(t).map((t=>{const s=i.Z.aircraft.generateId(),o={id:s,name:`${i.Z.aircraft.prefixName+s}`},n=dayjs().subtract(1,"day").startOf("hour");return o.flights=_.range(e).map((e=>{let s=n.add(Math.round(4*(e+Math.random())*4)/4,"hour");const o=s.add(n.add(Math.round(4*(e+1)),"hour").diff(s,"hour"),"hour");o.isSame(s)&&(s=o.subtract(45,"minute"));const h={id:i.Z.aircraft.generateId(),departureDate:s.utc().toDate(),arrivalDate:o.utc().toDate(),type:{id:"usual"}};return Math.random()>.8&&(h.type={id:"service",name:Math.random()>.5?i.Z.flight.types.service.availability.id:i.Z.flight.types.service.maintenance.id},h.type.text=i.Z.flight.types.service[h.type.name].text,h.type.fill=i.Z.flight.types.service[h.type.name].fill),this.generateAllCrossRowLinkedRects({crossRowLinkedRects:r,aircraftIndex:t,flight:h,aircraftAlreadyWithArrow:a}),h})),o}));return this.setLinkToCrossRowLinkedRects(r),s},generateAllCrossRowLinkedRects(t){let{crossRowLinkedRects:e,aircraftIndex:r,flight:a,aircraftAlreadyWithArrow:i}=t;"service"!==a.type.id||i[r]||(e.push(a),i[r]=!0)},setLinkToCrossRowLinkedRects(t){t.forEach(((e,r)=>{e.linkTo=r%2==1?t[r-1]?.id:t[r+1]?.id}))}},o=new Map,n=new Map,h=(0,a.Q_)("aircraft",{state:()=>({aircrafts:[],alreadyFetched:!1}),getters:{getFlight:t=>e=>{const r=n.get(e);return null==r?null:t.aircrafts[r.aircraftIndex].flights[r.flightIndex]},getAircraftByFlightId:t=>e=>{const r=n.get(e);return null==r?null:t.aircrafts[r.aircraftIndex]},minDepartureMs:t=>t.aircrafts.reduce(((t,e)=>e.flights.reduce(((t,e)=>Math.min(t,e.departureDate.getTime())),t)),Number.MAX_SAFE_INTEGER),maxArrivalMs:t=>t.aircrafts.reduce(((t,e)=>e.flights.reduce(((t,e)=>Math.max(t,e.arrivalDate.getTime())),t)),0)},actions:{async fetch(t,e){this.aircrafts=await s.fetch(t,e),this.alreadyFetched=!0,this.aircrafts.forEach(((t,e)=>{o.set(t.id,{aircraftIndex:e}),t.flights.forEach(((t,r)=>{n.set(t.id,{aircraftIndex:e,flightIndex:r})}))}))},push(t){if(!o.get(t.id)){this.aircrafts.push(t);const e=this.aircrafts.length-1;o.set(t.id,{aircraftIndex:e}),t.flights.forEach(((t,r)=>{n.set(t.id,{aircraftIndex:e,flightIndex:r})}))}},splice(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.aircrafts.splice(e).forEach((t=>{o.delete(t.id),t.flights.forEach((t=>{n.delete(t.id)}))}))}}})},891:(t,e,r)=>{r.d(e,{Z:()=>c});var a=r(6252),i=r(9963);const s={class:"wrapper-page"},o={key:0,class:"main-header"},n={key:1,class:"main"},h={key:2,class:"main-footer"};const d={props:{show:{type:Boolean,default:!0}}};const c=(0,r(3744).Z)(d,[["render",function(t,e,r,d,c,l){return(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",s,[t.$slots.header?((0,a.wg)(),(0,a.iD)("header",o,[(0,a.WI)(t.$slots,"header",{},void 0,!0)])):(0,a.kq)("",!0),t.$slots.default?((0,a.wg)(),(0,a.iD)("main",n,[(0,a.WI)(t.$slots,"default",{},void 0,!0)])):(0,a.kq)("",!0),t.$slots.footer?((0,a.wg)(),(0,a.iD)("footer",h,[(0,a.WI)(t.$slots,"footer",{},void 0,!0)])):(0,a.kq)("",!0)],512)),[[i.vShow,r.show]])}],["__scopeId","data-v-aeb90b02"]])},4641:(t,e,r)=>{r.r(e),r.d(e,{default:()=>S});var a=r(891),i=r(6252),s=r(3577);const o={class:"fps"};var n=r(5762),h=r(2201),d=r(6755),c=r(9973);const l={key:1,class:"no-aircraft-message"};r(7658);var f=r(7578),u=r(9963);const g={data(){const t=this;return{store:(0,f.Z)(),config:c.Z,customShapes:[],chartOptions:{chart:{animation:!1,events:{render(){t.onRender(this)}}},plotOptions:{series:{allowPointSelect:!0,states:{inactive:{opacity:1}}}},series:[],title:{useHTML:!0,text:`${c.Z.chartTitle} - <a href="${t.productionAbsoluteUrl}/code-example/blob/master/src/docs/highcharts-gantt-research.md">research</a>`},xAxis:[{type:"datetime",range:dayjs.duration(24,"hours").asMilliseconds(),startOnTick:!0,endOnTick:!0,tickWidth:1,gridLineWidth:1,labels:{align:"center",useHtml:!0,formatter(){const t=dayjs(this.value);return t.isSame(t.startOf("day"))?`<b>${t.format(c.Z.shortDateFormat)}</b>`:t.format(c.Z.shortTimeFormat)}}}],yAxis:{categories:[],staticScale:60},navigator:{enabled:!0},tooltip:{outside:!0}}}},watch:{"store.alreadyFetched":{handler(){this.setData()}}},beforeUnmount(){this.customShapes.forEach((t=>{t.destroy()}))},methods:{setData(){const t=[],e=[];this.store.aircrafts.forEach(((r,a)=>{t.push({name:r.name,data:_.map(r.flights,(t=>({start:t.departureDate.getTime(),end:t.arrivalDate.getTime(),flight:t,y:a,color:"service"===t.type.id?t.type.fill:"transparent"})))}),e.push(r.name)})),this.chartOptions.series=t,this.chartOptions.yAxis.categories=e},onRender(t){this.customShapes.forEach((t=>{t.destroy()})),t.series.forEach((e=>{e.points.forEach((e=>{const r=e.plotX+t.plotLeft,a=e.plotY+t.plotTop-10;"usual"===e.options.flight.type.id?(this.addArrowUp({chart:t,x:r+c.Z.arrow.pointerSize,y:a}),this.addText({chart:t,text:dayjs(e.options.start).format("HH:mm"),x:r+7+c.Z.arrow.pointerSize,y:a-5},(t=>t.attr({rotation:90}))),this.addText({chart:t,text:dayjs(e.options.end).format("HH:mm"),x:r+e.shapeArgs.width-14,y:a-5},(t=>t.attr({rotation:90}))),this.addArrowDown({chart:t,x:r+e.shapeArgs.width-2*c.Z.arrow.pointerSize,y:a}),this.addBrackets({chart:t,x:r,y:a,point:e})):"service"===e.options.flight.type.id&&this.addText({chart:t,text:e.options.flight.type.text,x:r+e.shapeArgs.width/2-30,y:a+e.shapeArgs.height/2})}))}))},addText(t){let{chart:e,text:r,x:a,y:i}=t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.noop;const o=e.renderer.text(r,a,i).css({fontSize:"10px"});s(o),this._addShape(e,o,s)},addArrowUp(t){let{chart:e,x:r,y:a}=t;const i=r+c.Z.arrow.strokeWidth,s=a,o=e.renderer.path(["M",i,s+c.Z.arrow.length,"L",i,s,"L",i+c.Z.arrow.pointerSize,s+c.Z.arrow.pointerSize,"M",i,s,"L",i-c.Z.arrow.pointerSize,s+c.Z.arrow.pointerSize]).attr({"stroke-width":c.Z.arrow.strokeWidth,stroke:c.Z.arrow.color});this._addShape(e,o)},addArrowDown(t){let{chart:e,x:r,y:a}=t;const i=r+c.Z.arrow.strokeWidth,s=a,o=e.renderer.path(["M",i,s,"L",i,s+c.Z.arrow.length,"L",i-c.Z.arrow.pointerSize,s+c.Z.arrow.length-c.Z.arrow.pointerSize,"M",i,s+c.Z.arrow.length,"L",i+c.Z.arrow.pointerSize,s+c.Z.arrow.length-c.Z.arrow.pointerSize]).attr({"stroke-width":c.Z.arrow.strokeWidth,stroke:"black"});this._addShape(e,o)},addBrackets(t){let{chart:e,point:r,x:a,y:i}=t;const s=a+c.Z.arrow.strokeWidth,o=i,{size:n}=this.config.brackets,h=e.renderer.path(["M",s,o+n,"L",s,o+2*n,"L",s+r.shapeArgs.width+n,o+2*n,"L",s+r.shapeArgs.width+n,o+n]).attr({"stroke-width":c.Z.arrow.strokeWidth,stroke:c.Z.brackets.strokeColor});this._addShape(e,h)},_addShape(t,e){e.attr({zIndex:3}),e.add(),this.customShapes.push(e)}}},p=()=>{(0,u.useCssVars)((t=>({"2d6c9aa9":t.config.mainLayer.noAircraftsMessage.fill})))},m=g.setup;g.setup=m?(t,e)=>(p(),m(t,e)):p;const y=g;var w=r(3744);const x={components:{HighchartsGantt:(0,w.Z)(y,[["render",function(t,e,r,a,o,n){const h=(0,i.up)("highcharts");return o.store.alreadyFetched?((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[o.store.aircrafts.length?((0,i.wg)(),(0,i.j4)(h,{key:0,class:"chart","constructor-type":"ganttChart",options:o.chartOptions},null,8,["options"])):((0,i.wg)(),(0,i.iD)("span",l,(0,s.toDisplayString)(o.config.mainLayer.noAircraftsMessage.text),1))],64)):(0,i.kq)("",!0)}],["__scopeId","data-v-f985cd64"]])},data:()=>({moduleConfig:c.Z,fps:(0,n.sgm)()}),created(){this.init()},methods:{async init(){const{aircraftsCount:t,flightsCount:e}=(0,h.yj)().query;await d.Z.fetch(t,e)}}},Z=()=>{(0,u.useCssVars)((t=>({"7b42a467":t.moduleConfig.mainLayer.noAircraftsMessage.width,"4e7bffa5":t.moduleConfig.stageBackgroundColor})))},k=x.setup;x.setup=k?(t,e)=>(Z(),k(t,e)):Z;const v=x,S=(0,w.Z)(v,[["render",function(t,e,r,n,h,d){const c=(0,i.up)("highcharts-gantt"),l=a.Z;return(0,i.wg)(),(0,i.j4)(l,null,{default:(0,i.w5)((()=>[(0,i._)("div",o,"FPS: "+(0,s.toDisplayString)(h.fps),1),(0,i.Wm)(c)])),_:1})}],["__scopeId","data-v-4ff35178"]])}}]);
//# sourceMappingURL=12c519a.chunk.js.map