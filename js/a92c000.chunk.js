"use strict";(self.webpackChunkcode_example=self.webpackChunkcode_example||[]).push([[194],{5256:(t,e,a)=>{a.d(e,{Z:()=>c});var r=a(6767),i=a.n(r);var s=a(2822);const o="#cecece",n="#8eaaff",d="#c1c1c1",h="HH:mm",l=`DD MMM, ${h}`,c={rowHeight:40,stageBackgroundColor:"white",fixedLayerBorderStroke:"black",betweenItemsLineStroke:o,timelinePrimaryColor:i()(o).darken(.4).hex(),fontDefaults:{fontSize:16,fontFamily:"Helvetica",wrap:"none",ellipsis:!0},mainLayer:{flightRectTimeoutMs:4e3,rect:{regularFill:n,activeFill:i()(n).darken(.25).hex(),padding:6,strokeWidth:2},noAirplanesMessage:{width:245,height:16,text:"Добавьте сюда воздушные суда",fill:"#6c757d"}},fixedAside:{width:110,textStartX:15},fixedHeader:{height:40},stageScrollbarLayer:{bar:{minimumGreaterDimension:64,width:s.Z.isMobileDevice()?32:12,padding:0,regularFill:d,activeFill:i()(d).darken(.1).hex(),opacity:.7},airplaneNumber:{y:22,fontSize:12},datetime:{text:"Дата/время",x:35,y:5,fontSize:12}},timelineGrid:{opacity:{specialHour:1,regularHour:.3}},timelineLegend:{startOfDay:{underlineY:26,textStartY:8,dateFormat:l},startOfQuarterDay:{underlineY:32,textStartY:18,fontSize:12,dateFormat:"HH:mm"}},departure:"Вылет",arrival:"Посадка",airplane:{generateId:()=>+Math.random().toFixed(5).slice(2),number:"Номер борта",prefixName:"RA-"},serviceModes:{availability:{id:"availability",color:"#7f84ea",text:"Availability"},maintenance:{id:"maintenance",color:"#cd7e31",text:"Maintenance"}},timeFormat:h,shortTimeFormat:"H",dateFormat:l,shortDateFormat:"DD.MM"}},1041:(t,e,a)=>{a.d(e,{Z:()=>o});var r=a(4475),i=a(5256);const s={store:(0,r.Z)(),widthCorrectionPx:i.Z.fixedAside.width,heightCorrectionPx:i.Z.fixedHeader.height,totalHeight(){return this.store.airplanes.length?this.heightCorrectionPx+this.store.airplanes.length*i.Z.rowHeight:i.Z.mainLayer.noAirplanesMessage.height},totalWidth(){return this.store.maxArrivalMs?this.widthCorrectionPx+this.dateToPx(new Date(this.store.maxArrivalMs))+this.getTotalWidthCorrection():i.Z.mainLayer.noAirplanesMessage.width},dateToPx(t){const e=new Date(this.store.minDepartureMs);return dayjs(t).diff(e,"minute")},getCurrentXByIndex(t){return this.widthCorrectionPx+this.dateToPx(dayjs(this.store.minDepartureMs).add(1,"hour").startOf("hour").toDate())+(t-1)*this.getHourInPx()},getCurrentDateByIndex(t){return dayjs(this.store.minDepartureMs).add(t,"hour").startOf("hour")},getHourInPx(){return this.dateToPx(dayjs(this.store.minDepartureMs).add(1,"hour").toDate())},getTotalWidthCorrection(){let t=this.getHourInPx()/2;return this.isSpecialHour(dayjs(this.store.maxArrivalMs).hour())&&(t+=this.getHourInPx()/2),t},isSpecialHour:t=>t%6==0,setTextDefaults:t=>_.defaults(t,i.Z.fontDefaults)},o=new class{constructor(){this.store=(0,r.Z)(),this.timeline=s}async fetch(t,e){const a=await this.store.fetch(t,e);return window.backdoor=this.store,a}getFlightSummary(t){const e=this.store.getAirplaneByFlightId(t),a=this.store.getFlight(t);if(null==e||null==a)return"Некорректный flightId";const r=t=>dayjs(t).format(i.Z.shortDateFormat);return`${i.Z.airplane.number}: ${e.name}        \n        \n${i.Z.departure}: ${r(a.departureDate)}\n        \n${i.Z.arrival}: ${r(a.arrivalDate)}`}}},4475:(t,e,a)=>{a.d(e,{Z:()=>d});a(7658);var r=a(830),i=a(5256);const s={fetch(t,e){return new Promise((a=>a(this.generate(t,e))))},generate(t,e){t=Number.parseInt(t),(Number.isNaN(t)||t<0)&&(t=12),e=Number.parseInt(e),(Number.isNaN(e)||e<=0)&&(e=10);return _.range(t).map((()=>{const t=i.Z.airplane.generateId(),a={id:t,name:`${i.Z.airplane.prefixName+t}`},r=dayjs().subtract(1,"day").startOf("hour");return a.flights=_.range(e).map((t=>{let e=r.add(Math.round(4*(t+Math.random())*4)/4,"hour");const a=e.add(r.add(Math.round(4*(t+1)),"hour").diff(e,"hour"),"hour");a.isSame(e)&&(e=a.subtract(45,"minute"));const s={id:i.Z.airplane.generateId(),departureDate:e.toDate(),arrivalDate:a.toDate()};return Math.random()>.8&&(s.serviceMode={},s.serviceMode.id=Math.random()>.5?i.Z.serviceModes.availability.id:i.Z.serviceModes.maintenance.id),s})),a}))}},o=new Map,n=new Map,d=(0,r.Q_)("airplane",{state:()=>({airplanes:[],alreadyFetched:!1}),getters:{getFlight:t=>e=>{const a=o.get(e);if(null==a)return null;return t.airplanes[a.airplaneIndex].flights[a.flightIndex]},getAirplaneByFlightId:t=>e=>{const a=o.get(e);return null==a?null:t.airplanes[a.airplaneIndex]},minDepartureMs:t=>t.airplanes.reduce(((t,e)=>e.flights.reduce(((t,e)=>Math.min(t,e.departureDate.getTime())),t)),Number.MAX_SAFE_INTEGER),maxArrivalMs:t=>t.airplanes.reduce(((t,e)=>e.flights.reduce(((t,e)=>Math.max(t,e.arrivalDate.getTime())),t)),0)},actions:{async fetch(t,e){this.airplanes=await s.fetch(t,e),this.alreadyFetched=!0,this.airplanes.forEach(((t,e)=>{n.set(t.id,{airplaneIndex:e}),t.flights.forEach(((t,a)=>{o.set(t.id,{airplaneIndex:e,flightIndex:a})}))}))},push(t){if(!n.get(t.id)){this.airplanes.push(t);const e=this.airplanes.length-1;n.set(t.id,{airplaneIndex:e}),t.flights.forEach(((t,a)=>{o.set(t.id,{airplaneIndex:e,flightIndex:a})}))}},splice(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];this.airplanes.splice(e).forEach((t=>{n.delete(t.id),t.flights.forEach((t=>{o.delete(t.id)}))}))}}})},891:(t,e,a)=>{a.d(e,{Z:()=>l});var r=a(6252),i=a(9963);const s={class:"wrapper-page"},o={key:0,class:"main-header"},n={key:1,class:"main"},d={key:2,class:"main-footer"};const h={props:{show:{type:Boolean,default:!0}}};const l=(0,a(3744).Z)(h,[["render",function(t,e,a,h,l,c){return(0,r.wy)(((0,r.wg)(),(0,r.iD)("div",s,[t.$slots.header?((0,r.wg)(),(0,r.iD)("header",o,[(0,r.WI)(t.$slots,"header",{},void 0,!0)])):(0,r.kq)("",!0),t.$slots.default?((0,r.wg)(),(0,r.iD)("main",n,[(0,r.WI)(t.$slots,"default",{},void 0,!0)])):(0,r.kq)("",!0),t.$slots.footer?((0,r.wg)(),(0,r.iD)("footer",d,[(0,r.WI)(t.$slots,"footer",{},void 0,!0)])):(0,r.kq)("",!0)],512)),[[i.vShow,a.show]])}],["__scopeId","data-v-aeb90b02"]])},4492:(t,e,a)=>{a.r(e),a.d(e,{default:()=>D});var r=a(891),i=a(6252),s=a(3577);const o={class:"fps"};var n=a(5762),d=a(2201),h=a(5256),l=a(1041);const c={key:1,class:"no-airplane-message"};a(7658);var p=a(4475),u=a(9963);const g={data(){const t=this,e=(0,p.Z)();return{config:h.Z,store:e,customShapes:[],arrowStrokeWidth:2,arrowPointerSize:2,chartOptions:{chart:{animation:!1,events:{render(){t.onRender(this)}}},plotOptions:{series:{allowPointSelect:!0,states:{inactive:{opacity:1}}}},series:[],title:{useHTML:!0,text:'<a href="https://www.highcharts.com/demo/gantt">Highcharts Gantt</a>'},xAxis:[{type:"datetime",range:dayjs.duration(24,"hours").asMilliseconds(),startOnTick:!0,endOnTick:!0,tickWidth:1,gridLineWidth:1,labels:{align:"center",useHtml:!0,formatter(){const t=dayjs(this.value).utc();return t.isSame(t.startOf("day"))?`<b>${t.format(h.Z.shortDateFormat)}</b>`:t.format(h.Z.shortTimeFormat)}}}],yAxis:{categories:[],staticScale:60},navigator:{enabled:!0},tooltip:{outside:!0}}}},watch:{"store.alreadyFetched":{handler(){this.setData()}}},methods:{setData(){const t=[],e=[];l.Z.store.airplanes.forEach(((a,r)=>{t.push({name:a.name,data:_.map(a.flights,(t=>({start:t.departureDate.getTime(),end:t.arrivalDate.getTime(),flight:t,y:r,color:t.serviceMode?h.Z.serviceModes[t.serviceMode.id].color:"transparent"})))}),e.push(a.name)})),this.chartOptions.series=t,this.chartOptions.yAxis.categories=e},onRender(t){this.customShapes.forEach((t=>{t.destroy()})),t.series.forEach((e=>{e.points.forEach((e=>{const a=e.plotX+t.plotLeft,r=e.plotY+t.plotTop-10;e.options.flight.serviceMode?this.addText({chart:t,text:h.Z.serviceModes[e.options.flight.serviceMode.id].text,x:a+e.shapeArgs.width/2-30,y:r+e.shapeArgs.height/2}):(this.addArrowUp({chart:t,x:a+this.arrowPointerSize,y:r}),this.addText({chart:t,text:dayjs(e.options.start).utc().format("HH:mm"),x:a+7+this.arrowPointerSize,y:r-5},(t=>t.attr({rotation:90}))),this.addText({chart:t,text:dayjs(e.options.end).utc().format("HH:mm"),x:a+e.shapeArgs.width-14,y:r-5},(t=>t.attr({rotation:90}))),this.addArrowDown({chart:t,x:a+e.shapeArgs.width-2*this.arrowPointerSize,y:r}),this.addBrackets({chart:t,x:a,y:r,point:e}))}))}))},addText(t,e){let{chart:a,text:r,x:i,y:s}=t;const o=a.renderer.text(r,i,s).css({fontSize:"10px",color:"black"});this._addShape(a,o,e)},addArrowUp(t){let{chart:e,x:a,y:r}=t;const i=a+this.arrowStrokeWidth,s=r,o=e.renderer.path(["M",i,s+20,"L",i,s,"L",i+this.arrowPointerSize,s+this.arrowPointerSize,"M",i,s,"L",i-this.arrowPointerSize,s+this.arrowPointerSize]).attr({"stroke-width":this.arrowStrokeWidth,stroke:"black"});this._addShape(e,o)},addArrowDown(t){let{chart:e,x:a,y:r}=t;const i=a+this.arrowStrokeWidth,s=r,o=e.renderer.path(["M",i,s,"L",i,s+20,"L",i-this.arrowPointerSize,s+20-this.arrowPointerSize,"M",i,s+20,"L",i+this.arrowPointerSize,s+20-this.arrowPointerSize]).attr({"stroke-width":this.arrowStrokeWidth,stroke:"black"});this._addShape(e,o)},addBrackets(t){let{chart:e,point:a,x:r,y:i}=t;const s=r+this.arrowStrokeWidth,o=i,n=10,d=e.renderer.path(["M",s-7,o+7+n,"L",s-7,o+7+20,"L",s-7+a.shapeArgs.width+n,o+7+20,"L",s-7+a.shapeArgs.width+n,o+7+n]).attr({"stroke-width":this.arrowStrokeWidth,stroke:"blue"});this._addShape(e,d)},_addShape(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.noop;e.attr({zIndex:3}),a(e),e.add(),this.customShapes.push(e)}}},m=()=>{(0,u.useCssVars)((t=>({83058812:t.config.mainLayer.noAirplanesMessage.fill})))},f=g.setup;g.setup=f?(t,e)=>(m(),f(t,e)):m;const w=g;var x=a(3744);const y={components:{Gantt:(0,x.Z)(w,[["render",function(t,e,a,r,o,n){const d=(0,i.up)("highcharts");return o.store.alreadyFetched?((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[o.store.airplanes.length?((0,i.wg)(),(0,i.j4)(d,{key:0,class:"chart","constructor-type":"ganttChart",options:o.chartOptions},null,8,["options"])):((0,i.wg)(),(0,i.iD)("span",c,(0,s.toDisplayString)(o.config.mainLayer.noAirplanesMessage.text),1))],64)):(0,i.kq)("",!0)}],["__scopeId","data-v-0e1a5092"]])},data:()=>({moduleConfig:h.Z,fps:(0,n.sgm)()}),created(){this.init()},methods:{async init(){const{airplanesCount:t,flightsCount:e}=(0,d.yj)().query;await l.Z.fetch(t,e)}}},v=()=>{(0,u.useCssVars)((t=>({"4fa83d2e":t.moduleConfig.mainLayer.noAirplanesMessage.width,"6ea2cfeb":t.moduleConfig.stageBackgroundColor})))},M=y.setup;y.setup=M?(t,e)=>(v(),M(t,e)):v;const S=y,D=(0,x.Z)(S,[["render",function(t,e,a,n,d,h){const l=(0,i.up)("gantt"),c=r.Z;return(0,i.wg)(),(0,i.j4)(c,null,{default:(0,i.w5)((()=>[(0,i._)("div",o,"FPS: "+(0,s.toDisplayString)(d.fps),1),(0,i.Wm)(l)])),_:1})}],["__scopeId","data-v-6e48bbbe"]])}}]);
//# sourceMappingURL=a92c000.chunk.js.map