"use strict";(self.webpackChunkcode_example=self.webpackChunkcode_example||[]).push([[295],{7420:(e,t,i)=>{i.r(t),i.d(t,{default:()=>F});var n=i(891),r=i(6252),o=i(3577);const a={class:"fps"},l={class:"chart-title"},s=["href"],g={ref:"stageContainer",class:"stage-container"};var d=i(5762),h=i(2201),c=i(2550),f=i(6755),m=i(7578),u=i(9973),y=i(9081),p=i(9969),x=i(2081);const w={data:()=>({config:u.Z,timeline:f.Z.timeline})};var C=i(3744);const B=(0,C.Z)(w,[["render",function(e,t,i,n,o,a){const l=x.Z,s=p.Z;return o.timeline.totalWidth()/o.timeline.getHourInPx()>=1?((0,r.wg)(!0),(0,r.iD)(r.HY,{key:0},(0,r.Ko)(Math.floor(o.timeline.totalWidth()/o.timeline.getHourInPx()),(e=>((0,r.wg)(),(0,r.iD)(r.HY,{key:e},[0===o.timeline.getCurrentDateByIndex(e).hour()?((0,r.wg)(),(0,r.iD)(r.HY,{key:0},[(0,r.Wm)(l,{config:{points:[o.timeline.getCurrentXByIndex(e),o.config.timelineLegend.startOfDay.underlineY,o.timeline.getCurrentXByIndex(e),o.config.fixedHeader.height],stroke:o.config.timelinePrimaryColor}},null,8,["config"]),(0,r.Wm)(l,{config:{points:[o.timeline.getCurrentXByIndex(e),o.config.timelineLegend.startOfDay.underlineY,o.timeline.getCurrentXByIndex(e)+o.timeline.getHourInPx(),o.config.timelineLegend.startOfDay.underlineY],stroke:o.config.timelinePrimaryColor}},null,8,["config"]),(0,r.Wm)(s,{config:{text:o.timeline.getCurrentDateByIndex(e).format(o.config.timelineLegend.startOfDay.dateFormat),x:o.timeline.getCurrentXByIndex(e),y:o.config.timelineLegend.startOfDay.textStartY,fill:o.config.timelinePrimaryColor}},null,8,["config"])],64)):o.timeline.isSpecialHour(o.timeline.getCurrentDateByIndex(e).hour())?((0,r.wg)(),(0,r.iD)(r.HY,{key:1},[(0,r.Wm)(l,{config:{points:[o.timeline.getCurrentXByIndex(e),o.config.timelineLegend.startOfQuarterDay.underlineY,o.timeline.getCurrentXByIndex(e),o.config.fixedHeader.height],stroke:o.config.timelinePrimaryColor}},null,8,["config"]),(0,r.Wm)(l,{config:{points:[o.timeline.getCurrentXByIndex(e),o.config.timelineLegend.startOfQuarterDay.underlineY,o.timeline.getCurrentXByIndex(e)+.6*o.timeline.getHourInPx(),o.config.timelineLegend.startOfQuarterDay.underlineY],stroke:o.config.timelinePrimaryColor}},null,8,["config"]),(0,r.Wm)(s,{config:{text:o.timeline.getCurrentDateByIndex(e).format(o.config.timelineLegend.startOfQuarterDay.dateFormat),x:o.timeline.getCurrentXByIndex(e),y:o.config.timelineLegend.startOfQuarterDay.textStartY,fontSize:o.config.timelineLegend.startOfQuarterDay.fontSize,fill:o.config.timelinePrimaryColor}},null,8,["config"])],64)):(0,r.kq)("",!0)],64)))),128)):(0,r.kq)("",!0)}]]);var S=i(6798);var b=i(8835);const H={inheritAttrs:!1,props:{config:{type:Object,required:!0}},data:()=>({rectConfig:{fill:u.Z.stageBackgroundColor}}),watch:{config:{deep:!0,immediate:!0,handler(){Object.assign(this.rectConfig,this.config)}}}},Z=(0,C.Z)(H,[["render",function(e,t,i,n,o,a){const l=b.Z;return(0,r.wg)(),(0,r.j4)(l,(0,r.dG)({config:o.rectConfig},e.$attrs),null,16,["config"])}]]),O={components:{OpaqueRect:Z},data:()=>({module:f.Z,store:(0,m.Z)(),config:u.Z}),methods:{getStage(){return this.$refs.layer.getStage()}}},L=(0,C.Z)(O,[["render",function(e,t,i,n,o,a){const l=(0,r.up)("opaque-rect"),s=p.Z,g=x.Z,d=(0,r.up)("k-layer");return(0,r.wg)(),(0,r.j4)(d,{ref:"layer"},{default:(0,r.w5)((()=>[o.store.aircrafts.length?((0,r.wg)(),(0,r.iD)(r.HY,{key:0},[(0,r.Wm)(l,{config:{x:0,y:o.config.fixedHeader.height,width:o.config.fixedAside.width,height:o.module.timeline.totalHeight()}},null,8,["config"]),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(o.store.aircrafts,((e,t)=>((0,r.wg)(),(0,r.iD)(r.HY,{key:e.name},[(0,r.Wm)(s,{config:{text:e.name,x:0,y:o.config.fixedHeader.height+o.config.row.height*t,width:o.config.fixedAside.width,height:o.config.row.height,verticalAlign:"middle"}},null,8,["config"]),(0,r.Wm)(g,{config:{points:[0,o.config.fixedHeader.height+o.config.row.height*t,o.config.fixedAside.width-1,o.config.fixedHeader.height+o.config.row.height*t],stroke:o.config.betweenItemsLineStroke}},null,8,["config"])],64)))),128)),(0,r.Wm)(g,{config:{points:[o.config.fixedAside.width,0,o.config.fixedAside.width,o.module.timeline.totalHeight()],stroke:o.config.fixedLayerBorderStroke}},null,8,["config"])],64)):(0,r.kq)("",!0)])),_:1},512)}]]),k=L;const v={components:{OpaqueRect:Z},data:()=>({module:f.Z,store:(0,m.Z)(),config:u.Z}),methods:{getStage(){return this.$refs.layer.getStage()}}},D=(0,C.Z)(v,[["render",function(e,t,i,n,o,a){const l=(0,r.up)("opaque-rect"),s=x.Z,g=(0,r.up)("k-layer");return(0,r.wg)(),(0,r.j4)(g,{ref:"layer"},{default:(0,r.w5)((()=>[o.store.aircrafts.length?((0,r.wg)(),(0,r.iD)(r.HY,{key:0},[(0,r.Wm)(l,{config:{x:0,y:0,width:o.module.timeline.totalWidth(),height:o.config.fixedHeader.height-1}},null,8,["config"]),(0,r.WI)(e.$slots,"timeline-legend"),(0,r.Wm)(s,{config:{points:[o.config.fixedAside.width,o.config.fixedHeader.height-1,o.module.timeline.totalWidth(),o.config.fixedHeader.height-1],stroke:o.config.fixedLayerBorderStroke}},null,8,["config"])],64)):(0,r.kq)("",!0)])),_:3},512)}]]);const W={components:{OpaqueRect:Z},props:{stage:{type:Object,required:!0},stageConfig:{type:Object,required:!0},mainLayer:{type:Object,required:!0},verticalScrollableLayers:{type:Array,required:!0},horizontalScrollableLayers:{type:Array,required:!0}},data:()=>({module:f.Z,store:(0,m.Z)(),config:u.Z,scrollBarOptions:{width:u.Z.stageScrollbarLayer.bar.width,padding:u.Z.stageScrollbarLayer.bar.padding,regularFill:u.Z.stageScrollbarLayer.bar.regularFill,activeFill:u.Z.stageScrollbarLayer.bar.activeFill,opacity:u.Z.stageScrollbarLayer.bar.opacity},vBarConfig:null,hBarConfig:null}),created(){const e=this;this.vBarConfig={width:this.scrollBarOptions.width,fill:this.scrollBarOptions.regularFill,y:this.scrollBarOptions.padding,opacity:this.scrollBarOptions.opacity,draggable:!0,dragBoundFunc(t){return t.x=e.stageConfig.width-e.scrollBarOptions.padding-e.scrollBarOptions.width,t.y=Math.max(Math.min(t.y,e.stageConfig.height-this.height()-e.scrollBarOptions.padding),e.scrollBarOptions.padding),t}},this.hBarConfig={height:this.scrollBarOptions.width,fill:this.scrollBarOptions.regularFill,x:this.scrollBarOptions.padding,opacity:this.scrollBarOptions.opacity,draggable:!0,dragBoundFunc(t){return t.x=Math.max(Math.min(t.x,e.stageConfig.width-this.width()-e.scrollBarOptions.padding),e.scrollBarOptions.padding),t.y=e.stageConfig.height-e.scrollBarOptions.padding-e.scrollBarOptions.width,t}};window.addEventListener("resize",_.throttle(this.onWindowResizeHandler,100)),this.onWindowResizeHandler()},mounted(){this.stage.on("wheel",this.onWheelHandler)},methods:{onWindowResizeHandler(){Object.assign(this.vBarConfig,{x:this.stageConfig.width-this.scrollBarOptions.padding-this.scrollBarOptions.width,height:Math.round(this.stageConfig.height*this.stageConfig.height/f.Z.timeline.totalHeight())}),Object.assign(this.hBarConfig,{y:this.stageConfig.height-this.scrollBarOptions.padding-this.scrollBarOptions.width,width:this.ensureComfortableScrollbarSize(Math.ceil(this.stageConfig.width*this.stageConfig.width/f.Z.timeline.totalWidth()))})},onPointerenterHandler(e){e.fill=this.scrollBarOptions.activeFill},onPointerleaveHandler(e){e.fill=this.scrollBarOptions.regularFill},onDragmoveVBarHandler(){const e=this.$refs.vBar.getStage(),t=this.stageConfig.height-2*this.scrollBarOptions.padding-e.height(),i=(e.y()-this.scrollBarOptions.padding)/t;this.verticalScrollableLayers.forEach((e=>e.y(-(f.Z.timeline.totalHeight()-this.stageConfig.height)*i)))},onDragmoveHBarHandler(){const e=this.$refs.hBar.getStage(),t=this.stageConfig.width-2*this.scrollBarOptions.padding-e.width(),i=(e.x()-this.scrollBarOptions.padding)/t;this.horizontalScrollableLayers.forEach((e=>e.x(-(f.Z.timeline.totalWidth()-this.stageConfig.width)*i)))},onWheelHandler(e){let{evt:t}=e;t.preventDefault();const i=t.deltaX,n=t.deltaY,r=this.$refs.vBar?.getStage(),o=this.$refs.hBar?.getStage(),a=-(f.Z.timeline.totalWidth()-this.stageConfig.width),l=Math.max(a,Math.min(this.mainLayer.x()-i,0)),s=-(f.Z.timeline.totalHeight()-this.stageConfig.height),g=Math.max(s,Math.min(this.mainLayer.y()-n,0));r&&this.verticalScrollableLayers.forEach((e=>e.y(g))),o&&this.horizontalScrollableLayers.forEach((e=>e.x(l)));const d=this.stageConfig.height-2*this.scrollBarOptions.padding-(r?.height()||0),h=this.mainLayer.y()/(-f.Z.timeline.totalHeight()+this.stageConfig.height)*d+this.scrollBarOptions.padding;r?.y(h);const c=this.stageConfig.width-2*this.scrollBarOptions.padding-(o?.width()||0),m=this.mainLayer.x()/(-f.Z.timeline.totalWidth()+this.stageConfig.width)*c+this.scrollBarOptions.padding;o?.x(m)},ensureComfortableScrollbarSize:e=>Math.max(u.Z.stageScrollbarLayer.bar.minimumGreaterDimension,e)}},P=(0,C.Z)(W,[["render",function(e,t,i,n,o,a){const l=b.Z,s=(0,r.up)("opaque-rect"),g=x.Z,d=p.Z,h=(0,r.up)("k-layer");return(0,r.wg)(),(0,r.j4)(h,null,{default:(0,r.w5)((()=>[o.store.aircrafts.length?((0,r.wg)(),(0,r.iD)(r.HY,{key:0},[i.stageConfig.height<o.module.timeline.totalHeight()?((0,r.wg)(),(0,r.j4)(l,{key:0,ref:"vBar",config:o.vBarConfig,onPointerenter:t[0]||(t[0]=e=>a.onPointerenterHandler(o.vBarConfig)),onPointerleave:t[1]||(t[1]=e=>a.onPointerleaveHandler(o.vBarConfig)),onDragmove:a.onDragmoveVBarHandler},null,8,["config","onDragmove"])):(0,r.kq)("",!0),i.stageConfig.width<o.module.timeline.totalWidth()?((0,r.wg)(),(0,r.j4)(l,{key:1,ref:"hBar",config:o.hBarConfig,onPointerenter:t[2]||(t[2]=e=>a.onPointerenterHandler(o.hBarConfig)),onPointerleave:t[3]||(t[3]=e=>a.onPointerleaveHandler(o.hBarConfig)),onDragmove:a.onDragmoveHBarHandler},null,8,["config","onDragmove"])):(0,r.kq)("",!0),(0,r.Wm)(s,{config:{x:0,y:0,width:o.config.fixedAside.width+1,height:o.config.fixedHeader.height+1}},null,8,["config"]),(0,r.Wm)(g,{config:{points:[o.config.fixedAside.width,o.config.fixedHeader.height+1,o.config.fixedAside.width,o.config.fixedHeader.height-2],stroke:o.config.fixedLayerBorderStroke}},null,8,["config"]),(0,r.Wm)(d,{config:{text:o.config.aircraft.number,x:0,y:o.config.stageScrollbarLayer.aircraftNumber.y,width:o.config.fixedAside.width,fontSize:o.config.stageScrollbarLayer.aircraftNumber.fontSize}},null,8,["config"]),(0,r.Wm)(d,{config:{text:o.config.stageScrollbarLayer.datetime.text,x:0,y:o.config.stageScrollbarLayer.datetime.y,width:o.config.fixedAside.width,fontSize:o.config.stageScrollbarLayer.datetime.fontSize}},null,8,["config"])],64)):(0,r.kq)("",!0)])),_:1})}]]);var z=i(9963);const q={components:{MainLayer:S.Z,FixedAsideLayer:k,FixedHeaderLayer:D,StageScrollbarLayer:P,TimelineGrid:y.Z,TimelineLegend:B},data:()=>({module:f.Z,store:(0,m.Z)(),moduleConfig:u.Z,toast:c.Z,stage:null,configs:{stage:{width:0,height:0},stageScrollbar:{props:{readyToMount:!1}}},widthCorrectionPx:u.Z.fixedAside.width,heightCorrectionPx:u.Z.fixedHeader.height,fps:(0,d.sgm)()}),watch:{"store.aircrafts":{handler(){this.actualizeStageDimensions()},deep:!0}},beforeUnmount(){c.Z.clear()},created(){this.init()},methods:{async init(){const{aircraftsCount:e,flightsCount:t}=(0,h.yj)().query;f.Z.timeline.setWidthCorrectionPx(this.widthCorrectionPx),f.Z.timeline.setHeightCorrectionPx(this.heightCorrectionPx),await f.Z.fetch(e,t),await this.initStage()},async initStage(){window.addEventListener("resize",_.throttle(this.actualizeStageDimensions,100)),this.actualizeStageDimensions(),await this.$nextTick(),this.stage=this.$refs.stage.getStage(),this.stage.container().style.backgroundColor=this.moduleConfig.stageBackgroundColor;const e=this.$refs.main.getStage(),t=this.$refs.fixedAside.getStage(),i=this.$refs.fixedHeader.getStage();Object.assign(this.configs.stageScrollbar.props,{stage:this.stage,stageConfig:this.configs.stage,mainLayer:e,verticalScrollableLayers:[e,t],horizontalScrollableLayers:[e,i]}),this.configs.stageScrollbar.props.readyToMount=!0},actualizeStageDimensions(){this.configs.stage.width=Math.min(f.Z.timeline.totalWidth(),this.$refs.stageContainer.offsetWidth),this.configs.stage.height=Math.min(f.Z.timeline.totalHeight(),this.$refs.stageContainer.offsetHeight),this.stage?this.stage.getContainer().style.border=""+(this.store.aircrafts.length?"1px solid black":"none"):setTimeout(this.actualizeStageDimensions,0)}}},A=()=>{(0,z.useCssVars)((e=>({"07b8507d":e.moduleConfig.stageBackgroundColor,"8456c982":e.moduleConfig.mainLayer.noAircraftsMessage.width,"3a205a64":e.moduleConfig.mainLayer.noAircraftsMessage.height})))},I=q.setup;q.setup=I?(e,t)=>(A(),I(e,t)):A;const M=q,F=(0,C.Z)(M,[["render",function(e,t,i,d,h,c){const f=(0,r.up)("timeline-grid"),m=(0,r.up)("main-layer"),u=(0,r.up)("fixed-aside-layer"),y=(0,r.up)("timeline-legend"),p=(0,r.up)("fixed-header-layer"),x=(0,r.up)("stage-scrollbar-layer"),w=(0,r.up)("k-stage"),C=n.Z;return(0,r.wg)(),(0,r.j4)(C,null,{default:(0,r.w5)((()=>[(0,r._)("div",a,"FPS: "+(0,o.toDisplayString)(h.fps),1),(0,r._)("h3",l,[(0,r.Uk)((0,o.toDisplayString)(h.moduleConfig.chartTitle)+" - ",1),(0,r._)("a",{href:e.productionAbsoluteUrl+"/code-example/blob/master/src/docs/research/konva.md"},"research",8,s)]),(0,r._)("div",g,[h.configs.stage.height?((0,r.wg)(),(0,r.j4)(w,{key:0,ref:"stage",config:h.configs.stage},{default:(0,r.w5)((()=>[(0,r.Wm)(m,{ref:"main","width-correction-px":h.widthCorrectionPx,"height-correction-px":h.heightCorrectionPx,onFlightServicePointerdown:t[0]||(t[0]=e=>h.toast.showInfo(h.module.getFlightSummary(e),{timeout:h.moduleConfig.mainLayer.flightRectTimeoutMs})),onFlightServicePointerenter:t[1]||(t[1]=e=>h.stage.container().style.cursor="pointer"),onFlightServicePointerleave:t[2]||(t[2]=e=>h.stage.container().style.cursor="default")},{"timeline-grid":(0,r.w5)((()=>[(0,r.Wm)(f)])),_:1},8,["width-correction-px","height-correction-px"]),(0,r.Wm)(u,{ref:"fixedAside"},null,512),(0,r.Wm)(p,{ref:"fixedHeader"},{"timeline-legend":(0,r.w5)((()=>[(0,r.Wm)(y)])),_:1},512),h.configs.stageScrollbar.props.readyToMount?((0,r.wg)(),(0,r.j4)(x,(0,o.normalizeProps)((0,r.dG)({key:0},h.configs.stageScrollbar.props)),null,16)):(0,r.kq)("",!0)])),_:1},8,["config"])):(0,r.kq)("",!0)],512)])),_:1})}],["__scopeId","data-v-324aa8cd"]])}}]);
//# sourceMappingURL=4e5dfbf.chunk.js.map