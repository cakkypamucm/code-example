(self.webpackChunkcode_example=self.webpackChunkcode_example||[]).push([[179],{2822:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var s=r(1860),a=r.n(s);const n=window.matchMedia("(any-pointer: coarse)").matches,o={storage:a(),formatter:{normalizePropName:e=>(e.endsWith("ID")&&(e=`${e.slice(0,-2)}Id`),_.camelCase(e)),normalizePropNames:e=>_.isObject(e)?_.isArray(e)?e.map((e=>o.formatter.normalizePropNames(e))):Object.keys(e).reduce(((t,r)=>(t[o.formatter.normalizePropName(r)]=o.formatter.normalizePropNames(e[r]),t)),{}):e,toUniqueSpaces:e=>e.replace(/(\s)+/g,"$1")},sleep:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((t=>setTimeout(t,e)))},retry:async(e,t)=>{let{onEachRetryError:r,retries:s,retryIntervalMs:a}=t;try{return await e()}catch(t){if(r(s),s<=0)throw t;return await o.sleep(a),o.retry(e,{onEachRetryError:r,retries:s-1,retryIntervalMs:a})}},isMobileDevice:()=>n},i=o},8532:(e,t,r)=>{"use strict";var s=r(6486),a=r.n(s),n=r(2861),o=r(8662),i=r(7484),u=r.n(i),d=(r(600),r(178)),c=r.n(d),h=r(830),l=r(9963),g=r(6168),m=r.n(g),p=r(7816),y=r(9553),w=r(4816),f=r(3078),P=r(7270),k=r(8840),v=r.n(k),U=r(1913),b=r.n(U),O=r(5130),C=r.n(O),S=r(6252);const Z={},A=(0,r(3744).Z)(Z,[["render",function(e,t){const r=(0,S.up)("router-view");return(0,S.wg)(),(0,S.j4)(r)}]]);var I=r(2201),E=r(129),V=r.n(E),R=r(2262);const x=/Edge?\/(10[7-9]|1[1-9]\d|[2-9]\d{2}|\d{4,})(\.\d+|)(\.\d+|)|Firefox\/(10[7-9]|1[1-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Chrom(ium|e)\/(10[89]|1[1-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Maci.+ Version\/(1[6-9]|[2-9]\d|\d{3,})\.\d+([,.]\d+|)( Mobile\/\w+|) Safari\/|Chrome.+OPR\/(9[1-9]|\d{3,})\.\d+\.\d+|(CPU[ +]OS|iPhone[ +]OS|CPU[ +]iPhone|CPU IPhone OS|CPU iPad OS)[ +]+(1[5-9]|[2-9]\d|\d{3,})[._]\d+([._]\d+|)|Android:?[ /-](1{2}[1-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})(\.\d+|)(\.\d+|)|Mobile Safari.+OPR\/(7[3-9]|[89]\d|\d{3,})\.\d+\.\d+|Android.+Firefox\/(1{2}\d|1[2-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+Chrom(ium|e)\/(1{2}[1-9]|1[2-9]\d|[2-9]\d{2}|\d{4,})\.\d+(\.\d+|)|Android.+(UC? ?Browser|UCWEB|U3)[ /]?(1[3-9]|[2-9]\d|\d{3,})\.\d+\.\d+|SamsungBrowser\/(1[6-9]|[2-9]\d|\d{3,})\.\d+|Android.+MQ{2}Browser\/(1[3-9]|[2-9]\d|\d{3,})(\.\d+|)(\.\d+|)|K[Aa][Ii]OS\/([2-9]|\d{2,})\.\d+(\.\d+|)/;var D=r(6294),$=r(2822);let q;const M="app-last-visited-route";function N(e){return r(2275)(`./${e}.vue`)}const T="browser-is-not-supported",Q=()=>!x.test(navigator.userAgent),j=(0,I.p7)({history:(0,I.r5)("/"),parseQuery:e=>V().parse(e),stringifyQuery:e=>V().stringify(e)||"",routes:[{path:"/",name:"index",redirect:{name:"gantt"}},{path:"/flights",name:"flights",component:()=>N("flights/index"),meta:{title:"Перелеты"}},{path:"/flights/gantt",name:"gantt",component:()=>N("flights/gantt"),meta:{title:"Gantt demo"}},{path:"/login",name:"login",component:()=>N("login"),async beforeEnter(e,t,r){await new D.Z(j).isUserAuthenticated()?r({name:"index",replace:!0}):r()},meta:{public:!0,title:"Вход"}},{path:"/logout",name:"logout",async beforeEnter(e,t,r){try{await new D.Z(j).logout()}finally{r({name:"login",query:{redirect:{path:q.path,query:q.query}},replace:!0})}},meta:{public:!0}},{path:"/browser-is-not-supported",name:T,component:()=>N(T),beforeEnter(e,t,r){Q()?r():r({name:"index",replace:!0})},meta:{public:!0,title:"Версия браузера не поддерживается"}},{path:"/:pathMatch(.*)*",name:"not-found",component:()=>N("not-found"),meta:{title:"Страница не найдена"}}]});j.beforeEach((async(e,t,r)=>{if(document.title=_.template(e?.meta?.title||"\ufeff")(e.params),q=$.Z.storage.get(M),$.Z.storage.remove(M),Q()&&e.name!==T)return void r({name:T,replace:!0});const s=new D.Z(j);if(e.matched.some((e=>!e.meta.public)))return await s.isUserAuthenticated()?void r():void r({name:"login",query:{redirect:{path:e.path,query:e.query}}});r()})),window.addEventListener("beforeunload",(()=>{const e=(0,R.SU)(j.currentRoute);$.Z.storage.set(M,{path:e.path,query:e.query})}));const z=j,B=(0,l.createApp)(A);p.S({app:B,dsn:"https://fad9ba4b02084b828ad57e31a661f501@o4505107600441344.ingest.sentry.io/4505115923709952",integrations:[new y.gE({routingInstrumentation:w.x(z)}),new f.U],release:"1.6.1",trackComponents:!0,hooks:["mount","update","destroy"],tracesSampleRate:1,replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1}),window.Sentry=P,b()(v()),B.use((0,h.WB)()).use(z).use(m(),{prefix:"K"}).use(C()).mount("#app"),(0,o.ZP)(n.Z,{retries:2,retryDelay:()=>50}),window.$http=n.Z,a().templateSettings.interpolate=/{{([\S\s]+?)}}/g,a().templateSettings.evaluate=/{#([\S\s]+?)#}/g,window._=a(),u().extend(c()),u().locale("ru"),window.dayjs=u()},6294:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});r(7658);var s=r(2262),a=r(830),n=(r(1703),r(2822));class o{constructor(){this.storageIds={userData:"app-user-data",firstTime:"app-user-first-time",packageVersion:"app-package-version"},this.userData={id:1,name:"name"}}isUserAuthenticated(){return new Promise((e=>{e(n.Z.storage.has(this.storageIds.userData))}))}login(){return new Promise(((e,t)=>{const r=n.Z.storage.get(this.storageIds.userData);if(r)e(r);else try{const t=o._fakeQueryRetry("login",this.userData);n.Z.storage.set(this.storageIds.userData,t),e(t)}catch(e){t(e)}}))}async logout(){try{return await o._fakeQueryRetry("logout")}finally{n.Z.storage.remove(this.storageIds.userData)}}static async _fakeQueryRetry(e,t){const r=await n.Z.retry((()=>o._fakeQuery(e,t)),{onEachRetryError:t=>{console.debug(`${e}: неудачная попытка, осталось еще ${t} раз(а)`)},retries:2,retryIntervalMs:50});return console.debug(`${e}: успешное получение данных`),r}static _fakeQuery(e,t){return new Promise(((r,s)=>{setTimeout((()=>{Math.random()>.1**(1/3)?r(t):s(new Error(`Не удалось выполнить запрос ${e}`))}),400*Math.random())}))}getPackageVersion(){return new Promise((e=>{e(n.Z.storage.get(this.storageIds.packageVersion))}))}setPackageVersion(e){return new Promise((t=>{n.Z.storage.set(this.storageIds.packageVersion,e),t()}))}isUserNew(){return new Promise((e=>{e(!n.Z.storage.has(this.storageIds.firstTime))}))}setUserOld(){return new Promise((e=>{n.Z.storage.set(this.storageIds.firstTime,!1),e()}))}}const i=new o,u=(0,a.Q_)("auth",{state:()=>({userData:null}),actions:{isUserAuthenticated:()=>i.isUserAuthenticated(),async login(){this.userData=await i.login()},logout:()=>i.logout(),getPackageVersion:()=>i.getPackageVersion(),setPackageVersion:e=>i.setPackageVersion(e),isUserNew:()=>i.isUserNew(),setUserOld:()=>i.setUserOld()}});class d{constructor(e){if(d.instance)return d.instance;d.instance=this,this.$router=e,this.store=u(),this.scheduleTimeoutId=null,this.ensurePackageVersion()}async isUserAuthenticated(){const e=await this.store.isUserAuthenticated();clearTimeout(this.scheduleTimeoutId);const t=this.getCurrentRoute();return t.meta?.public||this.scheduleCheckAuth(),e}scheduleCheckAuth(){this.scheduleTimeoutId=setTimeout((async()=>{if(await this.isUserAuthenticated())this.scheduleCheckAuth();else{"login"!==this.getCurrentRoute().name&&this.$router.push({name:"login"})}}),6e4)}async login(){const e=await this.store.login(),t=this.getCurrentRoute(),{redirect:{path:r,query:s}}=t.query;return r&&r!==t.path?this.$router.push({path:r,query:s,replace:!0}):this.$router.push({name:"index",query:s}),e}logout(){return this.store.logout()}async ensurePackageVersion(){"1.6.1"!==await this.getPackageVersion()&&(await this.setPackageVersion("1.6.1"),this.$router.push({name:"logout"}))}getPackageVersion(){return this.store.getPackageVersion()}setPackageVersion(e){return this.store.setPackageVersion(e)}getCurrentRoute(){return(0,s.SU)(this.$router.currentRoute)}async isUserNew(){const e=await this.store.isUserNew();return e&&await this.setUserOld(),e}setUserOld(){return this.store.setUserOld()}}},2275:(e,t,r)=>{var s={"./browser-is-not-supported.vue":[3833,174],"./flights/gantt.vue":[997,216,12],"./flights/index.vue":[7414,216,184],"./login.vue":[5719,216,44],"./not-found.vue":[3428,19],"./routes/[id].vue":[725,216,845,691],"./routes/index.vue":[3840,216,845,625]};function a(e){if(!r.o(s,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],a=t[0];return Promise.all(t.slice(1).map(r.e)).then((()=>r(a)))}a.keys=()=>Object.keys(s),a.id=2275,e.exports=a},4654:()=>{}},e=>{e.O(0,[216],(()=>{return t=8532,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=54efce7.js.map