"use strict";(self.webpackChunkcode_example=self.webpackChunkcode_example||[]).push([[736],{8890:(t,e,i)=>{i.r(e),i.d(e,{default:()=>v});var s=i(891),a=i(6252),o=i(3577);const n={class:"fps"},r={class:"chart-title"},l=["href"],c={ref:"scrollContainer",class:"scroll-container"},g={class:"large-container"},h={ref:"stageContainer",class:"stage-container"};i(4633);var d=i(5762),f=i(2201),m=i(2550),u=i(6755),p=i(7578),C=i(9973),x=i(9081),w=i(5416),y=i(9963);const S={components:{MainLayer:w.Z,TimelineGrid:x.Z},data:()=>({moduleConfig:C.Z,module:u.Z,store:(0,p.Z)(),toast:m.Z,fps:(0,d.sgm)(),stage:null,configs:{stage:{width:0,height:0,padding:200}},widthCorrectionPx:0,heightCorrectionPx:0}),watch:{"store.aircrafts":{handler(){this.actualizeStageDimensions()},deep:!0}},beforeUnmount(){m.Z.clear()},created(){this.init()},methods:{async init(){const{aircraftsCount:t,flightsCount:e}=(0,f.yj)().query;u.Z.timeline.setWidthCorrectionPx(this.widthCorrectionPx),u.Z.timeline.setHeightCorrectionPx(this.heightCorrectionPx),await u.Z.fetch(t,e),await this.initStage()},async initStage(){window.addEventListener("resize",_.throttle(this.actualizeStageDimensions,100)),this.actualizeStageDimensions(),await this.$nextTick(),this.stage=this.$refs.stage.getStage(),this.stage.container().style.backgroundColor=this.moduleConfig.stageBackgroundColor;const{scrollContainer:t}=this.$refs,e=()=>{const e=t.scrollLeft-this.getStagePaddingForAxis("x"),i=t.scrollTop-this.getStagePaddingForAxis("y");this.stage.container().style.transform=`translate(${e}px, ${i}px)`,this.stage.x(-e),this.stage.y(-i)};t.addEventListener("scroll",e,{passive:!0}),e()},getStagePaddingForAxis(t){if(!this.store.aircrafts.length)return 0;let e;if("x"===t)e="width";else{if("y"!==t)return 0;e="height"}return e=_.upperFirst(e),u.Z.timeline[`total${e}`]()>this.$refs.scrollContainer[`offset${e}`]+2*this.configs.stage.padding?this.configs.stage.padding:0},actualizeStageDimensions(){this.configs.stage.width=Math.min(u.Z.timeline.totalWidth(),this.$refs.scrollContainer.offsetWidth+2*this.getStagePaddingForAxis("x")),this.configs.stage.height=Math.min(u.Z.timeline.totalHeight(),this.$refs.scrollContainer.offsetHeight+2*this.getStagePaddingForAxis("y")),this.$refs.stageContainer.style.width=`${this.configs.stage.width}px`,this.$refs.stageContainer.style.height=`${this.configs.stage.height}px`,this.stage?this.$refs.scrollContainer.style.border=""+(this.store.aircrafts.length?"1px solid black":"none"):setImmediate(this.actualizeStageDimensions)},testAnimationFrameDuration(){requestIdleCallback((()=>{this.$refs.scrollContainer.scrollLeft=100,requestAnimationFrame((()=>{const t=performance.now();requestAnimationFrame((()=>{console.log(`'requestAnimationFrame' handler took ${Math.floor(performance.now()-t)}ms`)}))}))}))}}},P=()=>{(0,y.useCssVars)((t=>({"0e9d81a2":t.moduleConfig.stageBackgroundColor,"46a056d6":t.module.timeline.totalWidth(),a91bc68e:t.module.timeline.totalHeight(),"1424ea71":t.moduleConfig.mainLayer.noAircraftsMessage.width,"56a969dc":t.moduleConfig.mainLayer.noAircraftsMessage.height})))},$=S.setup;S.setup=$?(t,e)=>(P(),$(t,e)):P;const k=S;const v=(0,i(3744).Z)(k,[["render",function(t,e,i,d,f,m){const u=(0,a.up)("timeline-grid"),p=(0,a.up)("main-layer"),C=(0,a.up)("k-stage"),x=s.Z;return(0,a.wg)(),(0,a.j4)(x,null,{default:(0,a.w5)((()=>[(0,a._)("div",n,"FPS: "+(0,o.toDisplayString)(f.fps),1),(0,a._)("h3",r,[(0,a.Uk)((0,o.toDisplayString)(f.moduleConfig.chartTitle)+" - ",1),(0,a._)("a",{href:t.productionAbsoluteUrl+"/code-example/blob/master/src/docs/konva-research.md"},"research",8,l)]),(0,a._)("div",c,[(0,a._)("div",g,[(0,a._)("div",h,[f.configs.stage.height?((0,a.wg)(),(0,a.j4)(C,{key:0,ref:"stage",config:f.configs.stage},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{"width-correction-px":f.widthCorrectionPx,"height-correction-px":f.heightCorrectionPx,onFlightServicePointerdown:e[0]||(e[0]=t=>f.toast.showInfo(f.module.getFlightSummary(t),{timeout:f.moduleConfig.mainLayer.flightRectTimeoutMs})),onFlightServicePointerenter:e[1]||(e[1]=t=>f.stage.container().style.cursor="pointer"),onFlightServicePointerleave:e[2]||(e[2]=t=>f.stage.container().style.cursor="default")},{"timeline-grid":(0,a.w5)((()=>[(0,a.Wm)(u)])),_:1},8,["width-correction-px","height-correction-px"])])),_:1},8,["config"])):(0,a.kq)("",!0)],512)])],512)])),_:1})}],["__scopeId","data-v-0cf5bca0"]])}}]);
//# sourceMappingURL=489708f.chunk.js.map