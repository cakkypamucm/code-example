"use strict";(self.webpackChunkcode_example=self.webpackChunkcode_example||[]).push([[599],{4164:(t,e,r)=>{r.d(e,{Z:()=>u});var a=r(6767),i=r.n(a);var s=r(2822);const o="#cecece",n="#8eaaff",d="#c1c1c1",h="HH:mm",c="DD.MM",l=`DD MMM, ${h}`,u={rowHeight:40,stageBackgroundColor:"white",fixedLayerBorderStroke:"black",betweenItemsLineStroke:o,timelinePrimaryColor:i()(o).darken(.4).hex(),fontDefaults:{fontSize:16,fontFamily:"Helvetica",wrap:"none",ellipsis:!0},mainLayer:{flightRectTimeoutMs:4e3,rect:{regularFill:n,activeFill:i()(n).darken(.25).hex(),padding:6,strokeWidth:2},noAircraftsMessage:{width:245,height:16,text:"Добавьте сюда воздушные суда",fill:"#6c757d"}},fixedAside:{width:110,textStartX:15},fixedHeader:{height:40},stageScrollbarLayer:{bar:{minimumGreaterDimension:64,width:s.Z.isMobileDevice()?32:12,padding:0,regularFill:d,activeFill:i()(d).darken(.1).hex(),opacity:.7},aircraftNumber:{y:22,fontSize:12},datetime:{text:"Дата/время",x:35,y:5,fontSize:12}},timelineGrid:{opacity:{specialHour:1,regularHour:.3}},timelineLegend:{startOfDay:{underlineY:26,textStartY:8,dateFormat:c},startOfQuarterDay:{underlineY:32,textStartY:18,fontSize:12,dateFormat:h}},chartTitle:"Расписание перелетов",departure:"Вылет",arrival:"Посадка",aircraft:{generateId:()=>+Math.random().toFixed(5).slice(2),number:"Номер борта",prefixName:"RA-"},serviceModes:{availability:{id:"availability",color:"#7f84ea",text:"Availability"},maintenance:{id:"maintenance",color:"#cd7e31",text:"Maintenance"}},timeFormat:h,shortTimeFormat:"H",dateFormat:l,shortDateFormat:c}},6755:(t,e,r)=>{r.d(e,{Z:()=>o});var a=r(7578),i=r(4164);const s={store:(0,a.Z)(),widthCorrectionPx:i.Z.fixedAside.width,heightCorrectionPx:i.Z.fixedHeader.height,totalHeight(){return this.store.aircrafts.length?this.heightCorrectionPx+this.store.aircrafts.length*i.Z.rowHeight:i.Z.mainLayer.noAircraftsMessage.height},totalWidth(){return this.store.maxArrivalMs?this.widthCorrectionPx+this.dateToPx(new Date(this.store.maxArrivalMs))+this.getTotalWidthCorrection():i.Z.mainLayer.noAircraftsMessage.width},dateToPx(t){const e=new Date(this.store.minDepartureMs);return dayjs(t).diff(e,"minute")},getCurrentXByIndex(t){return this.widthCorrectionPx+this.dateToPx(dayjs(this.store.minDepartureMs).add(1,"hour").startOf("hour").toDate())+(t-1)*this.getHourInPx()},getCurrentDateByIndex(t){return dayjs(this.store.minDepartureMs).add(t,"hour").startOf("hour")},getHourInPx(){return this.dateToPx(dayjs(this.store.minDepartureMs).add(1,"hour").toDate())},getTotalWidthCorrection(){let t=this.getHourInPx()/2;return this.isSpecialHour(dayjs(this.store.maxArrivalMs).hour())&&(t+=this.getHourInPx()/2),t},isSpecialHour:t=>t%6==0,setTextDefaults:t=>_.defaults(t,i.Z.fontDefaults)},o=new class{constructor(){this.store=(0,a.Z)(),this.timeline=s}async fetch(t,e){const r=await this.store.fetch(t,e);return window.backdoor=this.store,r}getFlightSummary(t){const e=this.store.getAircraftByFlightId(t),r=this.store.getFlight(t);if(null==e||null==r)return"Некорректный flightId";const a=t=>dayjs(t).format(i.Z.shortDateFormat);return`${i.Z.aircraft.number}: ${e.name}        \n        \n${i.Z.departure}: ${a(r.departureDate)}\n        \n${i.Z.arrival}: ${a(r.arrivalDate)}`}}},7578:(t,e,r)=>{r.d(e,{Z:()=>d});r(7658);var a=r(830),i=r(4164);const s={fetch(t,e){return new Promise((r=>r(this.generate(t,e))))},generate(t,e){t=Number.parseInt(t),(Number.isNaN(t)||t<0)&&(t=12),e=Number.parseInt(e),(Number.isNaN(e)||e<=0)&&(e=10);return _.range(t).map((()=>{const t=i.Z.aircraft.generateId(),r={id:t,name:`${i.Z.aircraft.prefixName+t}`},a=dayjs().subtract(1,"day").startOf("hour");return r.flights=_.range(e).map((t=>{let e=a.add(Math.round(4*(t+Math.random())*4)/4,"hour");const r=e.add(a.add(Math.round(4*(t+1)),"hour").diff(e,"hour"),"hour");r.isSame(e)&&(e=r.subtract(45,"minute"));const s={id:i.Z.aircraft.generateId(),departureDate:e.toDate(),arrivalDate:r.toDate()};return Math.random()>.8&&(s.serviceMode={},s.serviceMode.id=Math.random()>.5?i.Z.serviceModes.availability.id:i.Z.serviceModes.maintenance.id),s})),r}))}},o=new Map,n=new Map,d=(0,a.Q_)("aircraft",{state:()=>({aircrafts:[],alreadyFetched:!1}),getters:{getFlight:t=>e=>{const r=n.get(e);return null==r?null:t.aircrafts[r.aircraftIndex].flights[r.flightIndex]},getAircraftByFlightId:t=>e=>{const r=n.get(e);return null==r?null:t.aircrafts[r.aircraftIndex]},minDepartureMs:t=>t.aircrafts.reduce(((t,e)=>e.flights.reduce(((t,e)=>Math.min(t,e.departureDate.getTime())),t)),Number.MAX_SAFE_INTEGER),maxArrivalMs:t=>t.aircrafts.reduce(((t,e)=>e.flights.reduce(((t,e)=>Math.max(t,e.arrivalDate.getTime())),t)),0)},actions:{async fetch(t,e){this.aircrafts=await s.fetch(t,e),this.alreadyFetched=!0,this.aircrafts.forEach(((t,e)=>{o.set(t.id,{aircraftIndex:e}),t.flights.forEach(((t,r)=>{n.set(t.id,{aircraftIndex:e,flightIndex:r})}))}))},push(t){if(!o.get(t.id)){this.aircrafts.push(t);const e=this.aircrafts.length-1;o.set(t.id,{aircraftIndex:e}),t.flights.forEach(((t,r)=>{n.set(t.id,{aircraftIndex:e,flightIndex:r})}))}},splice(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.aircrafts.splice(e).forEach((t=>{o.delete(t.id),t.flights.forEach((t=>{n.delete(t.id)}))}))}}})},891:(t,e,r)=>{r.d(e,{Z:()=>c});var a=r(6252),i=r(9963);const s={class:"wrapper-page"},o={key:0,class:"main-header"},n={key:1,class:"main"},d={key:2,class:"main-footer"};const h={props:{show:{type:Boolean,default:!0}}};const c=(0,r(3744).Z)(h,[["render",function(t,e,r,h,c,l){return(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",s,[t.$slots.header?((0,a.wg)(),(0,a.iD)("header",o,[(0,a.WI)(t.$slots,"header",{},void 0,!0)])):(0,a.kq)("",!0),t.$slots.default?((0,a.wg)(),(0,a.iD)("main",n,[(0,a.WI)(t.$slots,"default",{},void 0,!0)])):(0,a.kq)("",!0),t.$slots.footer?((0,a.wg)(),(0,a.iD)("footer",d,[(0,a.WI)(t.$slots,"footer",{},void 0,!0)])):(0,a.kq)("",!0)],512)),[[i.vShow,r.show]])}],["__scopeId","data-v-aeb90b02"]])},7526:(t,e,r)=>{r.r(e),r.d(e,{default:()=>D});var a=r(891),i=r(6252),s=r(3577);const o={class:"fps"};var n=r(5762),d=r(2201),h=r(6755),c=r(4164);const l={key:1,class:"no-aircraft-message"};r(7658);var u=r(7578),f=r(9963);const g={data(){const t=this;return{store:(0,u.Z)(),config:c.Z,customShapes:[],arrowStrokeWidth:2,arrowPointerSize:2,chartOptions:{chart:{animation:!1,events:{render(){t.onRender(this)}}},plotOptions:{series:{allowPointSelect:!0,states:{inactive:{opacity:1}}}},series:[],title:{useHTML:!0,text:`${c.Z.chartTitle} - <a href="${t.productionAbsoluteUrl}/code-example/blob/master/src/docs/highcharts-gantt-research.md">research</a>`},xAxis:[{type:"datetime",range:dayjs.duration(24,"hours").asMilliseconds(),startOnTick:!0,endOnTick:!0,tickWidth:1,gridLineWidth:1,labels:{align:"center",useHtml:!0,formatter(){const t=dayjs(this.value).utc();return t.isSame(t.startOf("day"))?`<b>${t.format(c.Z.shortDateFormat)}</b>`:t.format(c.Z.shortTimeFormat)}}}],yAxis:{categories:[],staticScale:60},navigator:{enabled:!0},tooltip:{outside:!0}}}},watch:{"store.alreadyFetched":{handler(){this.setData()}}},beforeUnmount(){this.customShapes.forEach((t=>{t.destroy()}))},methods:{setData(){const t=[],e=[];this.store.aircrafts.forEach(((r,a)=>{t.push({name:r.name,data:_.map(r.flights,(t=>({start:t.departureDate.getTime(),end:t.arrivalDate.getTime(),flight:t,y:a,color:t.serviceMode?c.Z.serviceModes[t.serviceMode.id].color:"transparent"})))}),e.push(r.name)})),this.chartOptions.series=t,this.chartOptions.yAxis.categories=e},onRender(t){this.customShapes.forEach((t=>{t.destroy()})),t.series.forEach((e=>{e.points.forEach((e=>{const r=e.plotX+t.plotLeft,a=e.plotY+t.plotTop-10;e.options.flight.serviceMode?this.addText({chart:t,text:c.Z.serviceModes[e.options.flight.serviceMode.id].text,x:r+e.shapeArgs.width/2-30,y:a+e.shapeArgs.height/2}):(this.addArrowUp({chart:t,x:r+this.arrowPointerSize,y:a}),this.addText({chart:t,text:dayjs(e.options.start).utc().format("HH:mm"),x:r+7+this.arrowPointerSize,y:a-5},(t=>t.attr({rotation:90}))),this.addText({chart:t,text:dayjs(e.options.end).utc().format("HH:mm"),x:r+e.shapeArgs.width-14,y:a-5},(t=>t.attr({rotation:90}))),this.addArrowDown({chart:t,x:r+e.shapeArgs.width-2*this.arrowPointerSize,y:a}),this.addBrackets({chart:t,x:r,y:a,point:e}))}))}))},addText(t){let{chart:e,text:r,x:a,y:i}=t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.noop;const o=e.renderer.text(r,a,i).css({fontSize:"10px",color:"black"});s(o),this._addShape(e,o,s)},addArrowUp(t){let{chart:e,x:r,y:a}=t;const i=r+this.arrowStrokeWidth,s=a,o=e.renderer.path(["M",i,s+20,"L",i,s,"L",i+this.arrowPointerSize,s+this.arrowPointerSize,"M",i,s,"L",i-this.arrowPointerSize,s+this.arrowPointerSize]).attr({"stroke-width":this.arrowStrokeWidth,stroke:"black"});this._addShape(e,o)},addArrowDown(t){let{chart:e,x:r,y:a}=t;const i=r+this.arrowStrokeWidth,s=a,o=e.renderer.path(["M",i,s,"L",i,s+20,"L",i-this.arrowPointerSize,s+20-this.arrowPointerSize,"M",i,s+20,"L",i+this.arrowPointerSize,s+20-this.arrowPointerSize]).attr({"stroke-width":this.arrowStrokeWidth,stroke:"black"});this._addShape(e,o)},addBrackets(t){let{chart:e,point:r,x:a,y:i}=t;const s=a+this.arrowStrokeWidth,o=i,n=10,d=e.renderer.path(["M",s-7,o+7+n,"L",s-7,o+7+20,"L",s-7+r.shapeArgs.width+n,o+7+20,"L",s-7+r.shapeArgs.width+n,o+7+n]).attr({"stroke-width":this.arrowStrokeWidth,stroke:"blue"});this._addShape(e,d)},_addShape(t,e){e.attr({zIndex:3}),e.add(),this.customShapes.push(e)}}},m=()=>{(0,f.useCssVars)((t=>({"8d7e3b90":t.config.mainLayer.noAircraftsMessage.fill})))},p=g.setup;g.setup=p?(t,e)=>(m(),p(t,e)):m;const x=g;var w=r(3744);const y={components:{Gantt:(0,w.Z)(x,[["render",function(t,e,r,a,o,n){const d=(0,i.up)("highcharts");return o.store.alreadyFetched?((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[o.store.aircrafts.length?((0,i.wg)(),(0,i.j4)(d,{key:0,class:"chart","constructor-type":"ganttChart",options:o.chartOptions},null,8,["options"])):((0,i.wg)(),(0,i.iD)("span",l,(0,s.toDisplayString)(o.config.mainLayer.noAircraftsMessage.text),1))],64)):(0,i.kq)("",!0)}],["__scopeId","data-v-0d2a6232"]])},data:()=>({moduleConfig:c.Z,fps:(0,n.sgm)()}),created(){this.init()},methods:{async init(){const{aircraftsCount:t,flightsCount:e}=(0,d.yj)().query;await h.Z.fetch(t,e)}}},v=()=>{(0,f.useCssVars)((t=>({"6f10967a":t.moduleConfig.mainLayer.noAircraftsMessage.width,"2a3e8210":t.moduleConfig.stageBackgroundColor})))},M=y.setup;y.setup=M?(t,e)=>(v(),M(t,e)):v;const S=y,D=(0,w.Z)(S,[["render",function(t,e,r,n,d,h){const c=(0,i.up)("gantt"),l=a.Z;return(0,i.wg)(),(0,i.j4)(l,null,{default:(0,i.w5)((()=>[(0,i._)("div",o,"FPS: "+(0,s.toDisplayString)(d.fps),1),(0,i.Wm)(c)])),_:1})}],["__scopeId","data-v-e18f96f8"]])}}]);
//# sourceMappingURL=e07804b.chunk.js.map