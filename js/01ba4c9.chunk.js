"use strict";(self.webpackChunkcode_example=self.webpackChunkcode_example||[]).push([[72],{9035:(t,e,o)=>{o.r(e),o.d(e,{default:()=>E});const s={mounted(t,e){!0===e.value&&(t.click(),setTimeout((()=>{t.focus()}),0))}};var i=o(3065),a=o(891),r=o(1490),n=o(1238),l=o(5860),d=o(6252),c=o(9963);const u={class:"row"},p={class:"col-12"},h=(t=>((0,d.dD)("data-v-b32d1918"),t=t(),(0,d.Cn)(),t))((()=>(0,d._)("h3",{class:"d-inline-block"},"Маршруты транспортных средств",-1))),m={key:0,class:"row main-content"},w={class:"sidebar"},g={class:"map"},k={key:1,class:"row"},C={class:"col-12"};o(7658);var y=o(5676),f=o(3577);o(1906);var M=o(7e3);const I={page:"Стр.",more:"ещё",to:"к",of:"из",next:"Следующая",last:"Последняя",first:"Первая",previous:"Предыдущая",loadingOoo:"Загрузка...",selectAll:"Выделить всё",searchOoo:"Поиск...",blanks:"Ничего не найдено",filterOoo:"Фильтровать...",applyFilter:"Применить фильтр...",equals:"Равно",notEqual:"Не равно",lessThan:"Меньше чем",greaterThan:"Больше чем",lessThanOrEqual:"Меньше или равно",greaterThanOrEqual:"Больше или равно",inRange:"В промежутке",contains:"Содержит",notContains:"Не содержит",startsWith:"Начинается с",endsWith:"Заканчивается",andCondition:'"И"',orCondition:'"ИЛИ"',group:"Группа",columns:"Столбцы",filters:"Фильтры",rowGroupColumns:"Столбцы группировки по строкам",rowGroupColumnsEmptyMessage:"Перетащите сюда для группировки по строкам",valueColumns:"Столбцы со значениями",pivotMode:"Режим сводной таблицы",groups:"Группы",values:"Значения",pivots:"Заголовки столбцов",valueColumnsEmptyMessage:"Перетащите сюда для агрегации",pivotColumnsEmptyMessage:"Перетащите сюда, чтобы задать заголовки столбам",toolPanelButton:"Панель инструментов",noRowsToShow:"Нет данных",pinColumn:"Закрепить колонку",valueAggregation:"Агрегация по значению",autosizeThiscolumn:"Автоматически задавать размер этой колонки",autosizeAllColumns:"Автоматически задавать размер всем колонкам",groupBy:"Группировать по",ungroupBy:"Разгруппировать по",resetColumns:"Сбросить столбцы",expandAll:"Развернуть всё",collapseAll:"Свернуть всё",toolPanel:"Панель инструментов",export:"Экспорт",csvExport:"Экспорт в CSV",excelExport:"Экспорт в Excel (.xlsx)",excelXmlExport:"Экспорт в XML (.xml)",pinLeft:"Закрепить слева <<",pinRight:"Закрепить справа >>",noPin:"Не закреплять <>",sum:"Сумма",min:"Минимум",max:"Максимум",none:"Пусто",count:"Количество",average:"Среднее значение",filteredRows:"Отфильтрованные",selectedRows:"Выделенные",totalRows:"Всего строк",totalAndFilteredRows:"Строк",copy:"Копировать",copyWithHeaders:"Копировать с заголовком",ctrlC:"Ctrl+C",paste:"Вставить",ctrlV:"Ctrl+V"};var A=o(2822);const b={components:{AgGridVue:M.n},inheritAttrs:!1,data:()=>({gridProps:{}}),created(){_.defaultsDeep(this.gridProps,this.$attrs,{"column-defs":this.$attrs["column-defs"].map((()=>({suppressMenu:!0,suppressMovable:!0}))),style:{width:"100%",height:"100%"},class:{"ag-theme-alpine":!0},pagination:!0,"pagination-page-size":10,"suppress-context-menu":!0,"tooltip-show-delay":A.Z.isMobileDevice()?100:500,"locale-text":I})}};var D=o(3744);const v=(0,D.Z)(b,[["render",function(t,e,o,s,i,a){const r=(0,d.up)("ag-grid-vue");return(0,d.wg)(),(0,d.j4)(r,(0,f.normalizeProps)((0,d.F4)(i.gridProps)),null,16)}],["__scopeId","data-v-14f15cb4"]]);var j=o(2820);const x={inheritAttrs:!1,emits:{"route-click":t=>!!t.id,"route-details-click":t=>!!t.id},data:()=>({store:(0,j.Z)(),columnDefs:[{headerName:"Имя",field:"name",flex:1},{headerName:"Кол-во остановок",headerTooltip:"Кол-во остановок",width:150,valueGetter:t=>t.data.stopIds.length}]}),computed:{rowData(){return this.store.routes}},methods:{rowClicked(t){this.$emit("route-click",{id:t.data.id})},getContextMenuItems(t){return[{name:"Подробно",action:()=>{this.$emit("route-details-click",{id:t.node.data.id})}}]}}},N=(0,D.Z)(x,[["render",function(t,e,o,s,i,a){const r=v;return(0,d.wg)(),(0,d.j4)(r,(0,d.dG)({"column-defs":i.columnDefs,"row-data":a.rowData,"row-style":{cursor:"pointer"},"suppress-context-menu":!1,"get-context-menu-items":a.getContextMenuItems},t.$attrs,{onRowClicked:a.rowClicked}),null,16,["column-defs","row-data","get-context-menu-items","onRowClicked"])}]]);const S={inheritAttrs:!1,emits:{"stop-click":t=>!(!t.id||!t.forward)},data:()=>({store:(0,j.Z)(),columnDefs:[{flex:1,headerName:"Имя",field:"stop.name",tooltipField:"stop.name"},{width:90,headerName:"Кол-во маршрутов",headerTooltip:"Кол-во маршрутов",valueGetter:t=>t.data.routeIds.length},{width:100,headerName:"Направление",valueGetter:t=>!0===t.data.forward?"Прямое":"Обратное"}]}),computed:{rowData(){return this.store.stopsWithForward}},methods:{rowClicked(t){this.$emit("stop-click",{id:t.data.stop.id,forward:t.data.forward})}}},R=(0,D.Z)(S,[["render",function(t,e,o,s,i,a){const r=v;return(0,d.wg)(),(0,d.j4)(r,(0,d.dG)({"column-defs":i.columnDefs,"row-data":a.rowData,"row-style":{cursor:"pointer"}},t.$attrs,{onRowClicked:a.rowClicked}),null,16,["column-defs","row-data","onRowClicked"])}]]);var O=o(5243),Z=o.n(O),T=o(7713);const W={components:{LMap:T.iA,LTileLayer:T.Hw,LPolyline:T.P6,LMarker:T.$R,LTooltip:T.Gs},props:{shownObjects:{type:Object,required:!0,validator:t=>void 0!==t.type&&void 0!==t.params}},data:()=>({store:(0,j.Z)(),routes:[],stopsWithForward:[],stopIcons:{forward:Z().icon({iconUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMjYiIHZpZXdCb3g9IjAgMCAyNiAyNiIgZmlsbD0ibm9uZSINCiAgICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCiAgICA8cGF0aCBkPSJNMTMgMTdDMTUuMjA5MSAxNyAxNyAxNS4yMDkxIDE3IDEzQzE3IDEwLjc5MDkgMTUuMjA5MSA5IDEzIDlDMTAuNzkwOSA5IDkNCjEwLjc5MDkgOSAxM0M5IDE1LjIwOTEgMTAuNzkwOSAxNyAxMyAxN1oiIHN0cm9rZT0iYmx1ZSIgc3Ryb2tlLXdpZHRoPSIyIg0KICAgICAgICAgIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIvPg0KPC9zdmc+",iconSize:[26,26]}),reverse:Z().icon({iconUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMjYiIHZpZXdCb3g9IjAgMCAyNiAyNiIgZmlsbD0ibm9uZSINCiAgICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCiAgICA8cGF0aCBkPSJNMTMgMTdDMTUuMjA5MSAxNyAxNyAxNS4yMDkxIDE3IDEzQzE3IDEwLjc5MDkgMTUuMjA5MSA5IDEzIDlDMTAuNzkwOSA5IDkNCjEwLjc5MDkgOSAxM0M5IDE1LjIwOTEgMTAuNzkwOSAxNyAxMyAxN1oiIHN0cm9rZT0icmVkIiBzdHJva2Utd2lkdGg9IjIiDQogICAgICAgICAgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIi8+DQo8L3N2Zz4=",iconSize:[26,26]})},routeColor:"#7B7B7B",needToFitBounds:!1}),watch:{shownObjects:{handler(t){this.showObjects(t)},deep:!0,immediate:!0}},methods:{polylineClicked(t){this.showObjects({type:"route",params:{id:t}})},stopClicked(t){let{id:e,forward:o}=t;this.showObjects({type:"stop",params:{id:e,forward:o}})},showObjects(t){let{type:e,params:o}=t;if(e){switch(e){case"routes":this.stopsWithForward=this.store.stopsWithForward,this.routes=this.store.routes;break;case"stops":this.stopsWithForward=this.store.stopsWithForward,this.routes=[];break;case"route":this.stopsWithForward=[],this.routes=[this.store.getRoute(o.id)];break;case"stop":this.stopsWithForward=[this.store.getStopWithForward(o.id,o.forward)],this.routes=[];break;default:return}this.fitBounds()}},fitBounds(){const t=[];this.stopsWithForward.length&&t.push(this.stopsWithForward.map((t=>{let{stop:e}=t;return[e.lat,e.lon]}))),this.routes.length&&t.push(this.routes.map((t=>this.getRouteLatLngs(t)))),t.length&&(this.$refs?.map?.leafletObject?this.$refs.map.leafletObject.fitBounds(new(Z().LatLngBounds)(t)):this.needToFitBounds=!0)},mapReadyHandler(){!0===this.needToFitBounds&&(this.fitBounds(),this.needToFitBounds=!1)},getStopIcon(t){return!0===t?this.stopIcons.forward:this.stopIcons.reverse},getStopKey:(t,e)=>Symbol.for(`app.stopId.${t.id}.${e}`),getRouteLatLngs:t=>t.points.map((t=>[t.lat,t.lon]))}},L={components:{RoutesGrid:N,StopGrid:R,RoutesMap:(0,D.Z)(W,[["render",function(t,e,o,s,i,a){const r=(0,d.up)("l-tile-layer"),n=(0,d.up)("l-tooltip"),l=(0,d.up)("l-marker"),c=(0,d.up)("l-polyline"),u=(0,d.up)("l-map");return(0,d.wg)(),(0,d.j4)(u,{ref:"map",style:{height:"100%",outline:"none"},zoom:10,center:[0,0],onReady:a.mapReadyHandler},{default:(0,d.w5)((()=>[(0,d.Wm)(r,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© <a target='_blank' href='https://osm.org/copyright'>OpenStreetMap</a> contributors"}),((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(i.stopsWithForward,(t=>{let{stop:e,forward:o}=t;return(0,d.wg)(),(0,d.j4)(l,{key:a.getStopKey(e,o),"lat-lng":[e.lat,e.lon],icon:a.getStopIcon(o),onClick:t=>a.stopClicked({id:e.id,forward:o})},{default:(0,d.w5)((()=>[(0,d.Wm)(n,null,{default:(0,d.w5)((()=>[(0,d.Uk)((0,f.toDisplayString)(e.name),1)])),_:2},1024)])),_:2},1032,["lat-lng","icon","onClick"])})),128)),((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(i.routes,(t=>((0,d.wg)(),(0,d.j4)(c,{key:t.id,"lat-lngs":a.getRouteLatLngs(t),color:i.routeColor,onClick:e=>a.polylineClicked(t.id)},{default:(0,d.w5)((()=>[(0,d.Wm)(n,null,{default:(0,d.w5)((()=>[(0,d.Uk)((0,f.toDisplayString)(t.name),1)])),_:2},1024)])),_:2},1032,["lat-lngs","color","onClick"])))),128))])),_:1},8,["onReady"])}],["__scopeId","data-v-3984c056"]])},data:()=>({mode:"",shownMapObjects:{type:"",params:{}}}),methods:{async getResources(){try{return await y.Z.fetch()}catch{}},routesClicked(){this.mode="routes",this.shownMapObjects.type="routes",this.shownMapObjects.params={}},stopsClicked(){this.mode="stops",this.shownMapObjects.type="stops",this.shownMapObjects.params={}},routeClicked(t){let{id:e}=t;this.shownMapObjects.type="route",this.shownMapObjects.params={id:e}},stopClicked(t){let{id:e,forward:o}=t;this.shownMapObjects.type="stop",this.shownMapObjects.params={id:e,forward:o}},routeDetailsClicked(t){let{id:e}=t;this.$router.push({name:"vehicle.routes.id",params:{id:e}})}}},E=(0,D.Z)(L,[["render",function(t,e,o,y,f,M){const I=l.Z,A=(0,d.up)("routes-grid"),b=(0,d.up)("stop-grid"),D=(0,d.up)("routes-map"),v=n.Z,j=r.Z,x=a.Z,N=i.Z,S=s;return(0,d.wg)(),(0,d.j4)(N,{promise:M.getResources(),"multi-root":!0},{combined:(0,d.w5)((o=>{let{isPending:s,isResolved:i}=o;return[(0,d.Wm)(x,{show:!s},(0,d.Nv)({_:2},[i?{name:"header",fn:(0,d.w5)((()=>[(0,d._)("div",u,[(0,d._)("div",p,[(0,d.wy)(((0,d.wg)(),(0,d.j4)(I,{onClick:M.routesClicked},{default:(0,d.w5)((()=>[(0,d.Uk)(" Маршруты ")])),_:1},8,["onClick"])),[[S,!0]]),(0,d.Wm)(I,{onClick:M.stopsClicked},{default:(0,d.w5)((()=>[(0,d.Uk)(" Остановки ")])),_:1},8,["onClick"]),h])])])),key:"0"}:void 0,s?void 0:{name:"default",fn:(0,d.w5)((()=>[i?((0,d.wg)(),(0,d.iD)("div",m,[(0,d._)("article",w,[(0,d.wy)((0,d.Wm)(A,{onRouteDetailsClick:M.routeDetailsClicked,onRouteClick:M.routeClicked},null,8,["onRouteDetailsClick","onRouteClick"]),[[c.vShow,"routes"===f.mode]]),(0,d.wy)((0,d.Wm)(b,{onStopClick:M.stopClicked},null,8,["onStopClick"]),[[c.vShow,"stops"===f.mode]])]),(0,d._)("article",g,[(0,d.Wm)(D,{"shown-objects":f.shownMapObjects},null,8,["shown-objects"])])])):((0,d.wg)(),(0,d.iD)("div",k,[(0,d._)("div",C,[(0,d.Wm)(v,{onPageRefresh:e[0]||(e[0]=e=>t.$router.go())})])]))])),key:"1"},s?void 0:{name:"footer",fn:(0,d.w5)((()=>[(0,d.Wm)(j)])),key:"2"}]),1032,["show"])]})),_:1},8,["promise"])}],["__scopeId","data-v-b32d1918"]])}}]);
//# sourceMappingURL=01ba4c9.chunk.js.map